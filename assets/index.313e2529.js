import{u as e,I as o,k as t,K as a,r as n,D as s,E as l,d as r,g as c,T as i,v as u,x as d,f as v,L as p,l as f,C as m,G as h,M as y,F as b,J as w}from"./index.b9b8891c.js";import{i as x,a as I,n as g,e as k,b as O,t as S,u as z,c as C,g as B,d as P,w as A,m as T,f as L,I as E}from"./index.e3573b62.js";import{u as X,o as Y,g as j,d as D}from"./index.f6f59bf0.js";function R(e,o){"scrollTop"in e?e.scrollTop=o:e.scrollTo(e.scrollX,o)}function F(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function H(e){R(window,e),R(document.body,e)}const M=x();function $(){M&&H(F())}const K=e=>e.stopPropagation();function N(e,o){("boolean"!=typeof e.cancelable||e.cancelable)&&e.preventDefault(),o&&K(e)}function V(o){const t=e(o);if(!t)return!1;const a=window.getComputedStyle(t),n="none"===a.display,s=null===t.offsetParent&&"fixed"!==a.position;return n||s}const{width:G,height:J}=X(),q="van-hairline--top-bottom",Q=Symbol("van-form");const U=Symbol();function W(e){const a=o(U,null);a&&t(a,(o=>{o&&e()}))}function Z(e){const o=a();o&&k(o.proxy,e)}const _={show:Boolean,zIndex:O,overlay:S,duration:O,teleport:[String,Object],lockScroll:S,lazyRender:S,beforeClose:Function,overlayStyle:Object,overlayClass:z,transitionAppear:Boolean,closeOnClickOverlay:S};function ee(){const e=n(0),o=n(0),t=n(0),a=n(0),s=n(0),l=n(0),r=n(""),c=()=>{t.value=0,a.value=0,s.value=0,l.value=0,r.value=""};return{move:n=>{const c=n.touches[0];t.value=(c.clientX<0?0:c.clientX)-e.value,a.value=c.clientY-o.value,s.value=Math.abs(t.value),l.value=Math.abs(a.value);var i,u;(!r.value||s.value<10&&l.value<10)&&(r.value=(i=s.value,u=l.value,i>u?"horizontal":u>i?"vertical":""))},start:t=>{c(),e.value=t.touches[0].clientX,o.value=t.touches[0].clientY},reset:c,startX:e,startY:o,deltaX:t,deltaY:a,offsetX:s,offsetY:l,direction:r,isVertical:()=>"vertical"===r.value,isHorizontal:()=>"horizontal"===r.value}}let oe=0;const te="van-overflow-hidden";function ae(e){const o=n(!1);return t(e,(e=>{e&&(o.value=e)}),{immediate:!0}),e=>()=>o.value?e():null}const[ne,se]=C("overlay");const le=A(r({name:ne,props:{show:Boolean,zIndex:O,duration:O,className:z,lockScroll:S,lazyRender:S,customStyle:Object},setup(e,{slots:o}){const t=n(),a=ae((()=>e.show||!e.lazyRender))((()=>{var a;const n=k(B(e.zIndex),e.customStyle);return P(e.duration)&&(n.animationDuration=`${e.duration}s`),u(c("div",{ref:t,style:n,class:[se(),e.className]},[null==(a=o.default)?void 0:a.call(o)]),[[d,e.show]])}));return D("touchmove",(o=>{e.lockScroll&&N(o,!0)}),{target:t}),()=>c(i,{name:"van-fade",appear:!0},{default:a})}})),re=k({},_,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ce,ie]=C("popup");const ue=A(r({name:ce,inheritAttrs:!1,props:re,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:a,slots:r}){let x,k;const O=n(),S=n(),z=ae((()=>e.show||!e.lazyRender)),C=v((()=>{const o={zIndex:O.value};if(P(e.duration)){o["center"===e.position?"animationDuration":"transitionDuration"]=`${e.duration}s`}return o})),B=()=>{x||(x=!0,O.value=void 0!==e.zIndex?+e.zIndex:L(),o("open"))},A=()=>{x&&function(e,{args:o=[],done:t,canceled:a}){if(e){const n=e.apply(null,o);I(n)?n.then((e=>{e?t():a&&a()})).catch(g):n?t():a&&a()}else t()}(e.beforeClose,{done(){x=!1,o("close"),o("update:show",!1)}})},T=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&A()},X=()=>{if(e.overlay)return c(le,{show:e.show,class:e.overlayClass,zIndex:O.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:T},{default:r["overlay-content"]})},R=e=>{o("clickCloseIcon",e),A()},F=()=>{if(e.closeable)return c(E,{role:"button",tabindex:0,name:e.closeIcon,class:[ie("close-icon",e.closeIconPosition),"van-haptics-feedback"],classPrefix:e.iconPrefix,onClick:R},null)},H=()=>o("opened"),M=()=>o("closed"),$=e=>o("keydown",e),K=z((()=>{var o;const{round:t,position:n,safeAreaInsetTop:s,safeAreaInsetBottom:l}=e;return u(c("div",w({ref:S,style:C.value,role:"dialog",tabindex:0,class:[ie({round:t,[n]:n}),{"van-safe-area-top":s,"van-safe-area-bottom":l}],onKeydown:$},a),[null==(o=r.default)?void 0:o.call(r),F()]),[[d,e.show]])})),V=()=>{const{position:o,transition:t,transitionAppear:a}=e;return c(i,{name:t||("center"===o?"van-fade":`van-popup-slide-${o}`),appear:a,onAfterEnter:H,onAfterLeave:M},{default:K})};return t((()=>e.show),(e=>{e&&!x&&(B(),0===a.tabindex&&p((()=>{var e;null==(e=S.value)||e.focus()}))),!e&&x&&(x=!1,o("close"))})),Z({popupRef:S}),function(e,o){const a=ee(),n=o=>{a.move(o);const t=a.deltaY.value>0?"10":"01",n=j(o.target,e.value),{scrollHeight:s,offsetHeight:l,scrollTop:r}=n;let c="11";0===r?c=l>=s?"00":"01":r+l>=s&&(c="10"),"11"===c||!a.isVertical()||parseInt(c,2)&parseInt(t,2)||N(o,!0)},r=()=>{document.addEventListener("touchstart",a.start),document.addEventListener("touchmove",n,{passive:!1}),oe||document.body.classList.add(te),oe++},c=()=>{oe&&(document.removeEventListener("touchstart",a.start),document.removeEventListener("touchmove",n),oe--,oe||document.body.classList.remove(te))},i=()=>o()&&c();Y((()=>o()&&r())),s(i),l(i),t(o,(e=>{e?r():c()}))}(S,(()=>e.show&&e.lockScroll)),D("popstate",(()=>{e.closeOnPopstate&&(A(),k=!1)})),f((()=>{e.show&&B()})),m((()=>{k&&(o("update:show",!0),k=!1)})),s((()=>{e.show&&e.teleport&&(A(),k=!0)})),h(U,(()=>e.show)),()=>e.teleport?c(y,{to:e.teleport},{default:()=>[X(),V()]}):c(b,null,[X(),V()])}}));export{q as B,Q as F,ue as P,ee as a,J as b,K as c,ae as d,F as g,V as i,W as o,N as p,$ as r,H as s,Z as u,G as w};
