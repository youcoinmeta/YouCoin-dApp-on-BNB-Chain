import{u as e,c as a}from"./contract.1adf2fa6.js";import{d as t,r as l,l as n,W as s,f as o,k as c,o as u,c as i,b as r,t as v,n as d,g as m,w as p,u as f,F as k,_ as b,h as w,x,y as U,a as y,s as S}from"./index.0c2b9d6b.js";import{U as g,B as h}from"./contract.1e3e3035.js";import{I as $}from"./index.1a2a6857.js";import{P as D}from"./index.546d84c6.js";import"./el-popper.a8a6b2b9.js";import{E as C}from"./el-input.dca4ca8c.js";import{c as I,D as R}from"./index.5403ce05.js";import{b as _,a as N}from"./dao.190b9589.js";import{a as O}from"./utils.59d2af20.js";import{A as B,D as j}from"./contract.cfb15a02.js";import{D as F,_ as T}from"./DaoPopup.bc0690de.js";import{E}from"./el-popover.b69ed70a.js";import"./event.365c2d6b.js";import"./icon.29d2cd17.js";import"./typescript.bf83b9a7.js";const P=["disabled"],V={class:"popup-dao"},Y={class:"title"},A={class:"input input-dao",style:{"margin-bottom":"10px"}},M={class:"max"},H={class:"input-left"},W={class:"balance"},G={class:"text"},L={class:"text"},q={class:"text"},z={class:"text"},J={class:"text"},K=b(t({__name:"StakeDialog",emits:["change","max"],setup(t,{emit:b}){const w=e(),{stakeUcon:x}=_(),U=a(),y=N(),S=l("");n(async()=>{});const R=l(null),j=l(!1);new s;const F=l(""),T=l(""),E=o(()=>U.account);c(E,async e=>{e&&X()},{immediate:!0});const K=o(()=>{if(Z.value)return Q.value.length>0;const{blockFlag:e}=y.accountInfo;return Q.value.length>0&&"0"===e}),Q=o(()=>{let e=[];return w.stakeList.forEach(a=>{let{level:t}=a;e.push(parseInt(t))}),e=e.sort(),e});async function X(){const e=await g.call("allowance",[E.value,"0x84EF0D09F9Ba4239976CC68cD6e549b5c8729dc1"]);S.value=e,T.value=await g.call("balanceOf",[E.value])}const Z=o(()=>"0"===S.value||1===new h(F.value).times("1e18").comparedTo(S.value)),ee=o(()=>{if(Z.value)return!0;const{stakeUCON:e}=y.accountInfo,{minStakeUcon:a}=y.daoSystemInfo,t=new h(a).dividedBy(new h(1e18)).toString(10);if(new h(e).dividedBy(new h(1e18)).toString(10),"0"===e){return!(1===new h(F.value).comparedTo(new h(T.value)))&&!Z.value&&parseFloat(F.value)>=parseFloat(t)}return!(1===new h(F.value).comparedTo(new h(T.value)))&&!Z.value&&""!==F.value&&-1!==new h(e).plus(new h(F.value).times(new h(1e18))).comparedTo(a)}),ae=o(()=>y.daoSystemInfo.uconStakeIncrease),te=o(()=>{if(ae.value.length>=2){return{value:`${I(ae.value[0].minStake)}~${I(ae.value[1].minStake)}`,rate:O(ae.value[0].increaseRate)}}return{value:0,rate:0}}),le=o(()=>{if(ae.value.length>=2){return{value:`${I(ae.value[1].minStake)}~${I(ae.value[2].minStake)}`,rate:O(ae.value[1].increaseRate)}}return{value:0,rate:0}}),ne=o(()=>{if(ae.value.length>=2){return{value:`${I(ae.value[2].minStake)}~${I(ae.value[3].minStake)}`,rate:O(ae.value[2].increaseRate)}}return{value:0,rate:0}}),se=o(()=>{if(ae.value.length>=2){return{value:`${I(ae.value[3].minStake)}`,rate:O(ae.value[3].increaseRate)}}return{value:0,rate:0}});function oe(e){parseFloat(e)<0?F.value="":1!==new h(e).times(1e18).comparedTo(new h(T.value))?F.value=e:F.value=new h(T.value).div(new h("10").exponentiatedBy(18)).decimalPlaces(6).toString(10)}async function ce(){if(Z.value){if(!K.value)return;await g.execute("approve",["0x84EF0D09F9Ba4239976CC68cD6e549b5c8729dc1",B]);const e=await g.call("allowance",[E.value,"0x84EF0D09F9Ba4239976CC68cD6e549b5c8729dc1"]);S.value=e}else{if(0===Q.value.length)return;K.value&&(j.value=!0)}}async function ue(){if(!ee.value)return;if(Z.value)return void ce();const e=new h(F.value).times(new h("10").exponentiatedBy(18)).decimalPlaces(0).toString(10);await x(e),y.getSystemInfo(),X(),ie()}function ie(){R.value?.scroll({top:0,behavior:"smooth"}),j.value=!1,F.value=""}return(e,a)=>{const t=$,l=C,n=D;return u(),i(k,null,[r("div",{class:d(["stake-btn",{"stake-btn-active":K.value}]),disabled:!K.value,onClick:ce},v(Z.value?e.$t("V1.Enable"):e.$t("V1.Stake")),11,P),m(n,{show:j.value,"onUpdate:show":a[1]||(a[1]=e=>j.value=e),position:"bottom","overlay-class":"popup-dao",teleport:"body",round:"",style:{height:"70%"},onClose:ie},{default:p(()=>[r("div",V,[r("h4",Y,[r("span",null,v(e.$t("DaoStake.title")),1),m(t,{name:"cross",onClick:a[0]||(a[0]=e=>j.value=!1)})]),r("div",{class:"popup-dao-content",ref_key:"el",ref:R},[r("div",A,[r("div",M,v(e.$t("DaoStake.title"))+" UCON",1),r("div",H,[m(l,{class:"value",type:"number","model-value":F.value,placeholder:"0",onInput:oe},null,8,["model-value"]),a[2]||(a[2]=r("span",{class:""},"UCON",-1))])]),r("div",W,v(e.$t("DaoStake.balance"))+": "+v(f(I)(T.value))+" UCON ",1),a[3]||(a[3]=r("div",{class:"border"},null,-1)),r("div",G,v(e.$t("DaoStake.text1",{value:f(I)(f(y).daoSystemInfo.minStakeUcon)})),1),r("div",L,v(e.$t("DaoStake.text2",{value:te.value.value,rate:te.value.rate})),1),r("div",q,v(e.$t("DaoStake.text3",{value:le.value.value,rate:le.value.rate})),1),r("div",z,v(e.$t("DaoStake.text2",{value:ne.value.value,rate:ne.value.rate})),1),r("div",J,v(e.$t("DaoStake.text2",{value:se.value.value,rate:se.value.rate})),1),r("div",{class:d(["btn",{btcActive:ee.value}]),onClick:ue},v(Z.value?e.$t("V1.Enable"):e.$t("V1.Stake")),3)],512)])]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-086dab75"]]),Q={class:"popover-info"},X={class:"popover-text"},Z={class:"btn"},ee={class:"text border"},ae={key:1,class:"btn"},te={class:"text"},le=b(t({__name:"RedeemBtn",setup(e){const a=N();return(e,t)=>{const l=E;return"0"!==f(a).accountInfo.processCount?(u(),w(l,{key:0,"popper-class":"popover-model",placement:"top",width:"328px",trigger:"hover","propper-style":"{background: blue}"},{reference:p(()=>[r("div",Z,[r("span",ee,v(e.$t("DaoRedeem.title")),1)])]),default:p(()=>[r("div",Q,[r("div",X,v(e.$t("DaoRedeem.text15")),1)])]),_:1})):(u(),i("div",ae,[r("span",te,v(e.$t("DaoRedeem.title")),1)]))}}}),[["__scopeId","data-v-13de1a3a"]]),ne={class:"text"},se={class:"input"},oe={class:"input-title"},ce={class:"flex"},ue={class:"flex input-content"},ie={class:"cell"},re={class:"cell-label"},ve={class:"cell"},de={class:"cell-label"},me={key:0,class:"desc"},pe={class:"text"},fe={class:"text"},ke=b(t({__name:"RedeemDialog",emits:["change","max"],setup(e,{emit:a}){const t=N(),{unstakeUcon:n}=_(),s=o(()=>t.accountInfo),c=o(()=>{const{blockFlag:e}=t.accountInfo;return"0"===s.value.stakeUCON&&t.isRedeem||"1"==e}),k=o(()=>new h(s.value.stakeUCON).minus(new h(t.daoSystemInfo.minStakeUcon)).toString(10)),b=o(()=>1===new h(S.value).times(new h(1e18)).comparedTo(new h(k.value))),U=l(null),y=a,S=l(""),g=o(()=>{const e=s.value.stakeUCON;if(""===S.value)return!1;const a=1===new h(S.value).times(1e18).comparedTo(e);return"0"!==e&&!a&&"0"===s.value.processCount});function $(e){parseFloat(e)<0?S.value="":1!==new h(e).times(1e18).comparedTo(new h(s.value.stakeUCON))?S.value=e:D()}function D(){S.value=new h(s.value.stakeUCON).div(new h("10").exponentiatedBy(18)).decimalPlaces(6).toString(10),y("change",S.value)}async function R(){const e=new h(S.value).times(new h("1e18")).decimalPlaces(0).toString(10);await n(e,t.daoSystemInfo.unstakeBurnUcon),t.getSystemInfo(),U.value?.handleClose()}return(e,a)=>{const l=C,n=T;return u(),w(F,{title:e.$t("DaoRedeem.title1")+" 1/2",classText:"stake-btn",disabled:c.value,ref_key:"el",ref:U},{content:p(()=>[r("div",se,[r("div",oe,v(e.$t("DaoRedeem.title"))+"UCON",1),r("div",ce,[r("div",ue,[m(l,{class:"value input-redeem",type:"number","model-value":S.value,placeholder:"0",onInput:$},null,8,["model-value"]),a[0]||(a[0]=r("span",{style:{color:"#ba7c00"},class:""},"UCON",-1))]),r("p",{class:"max",onClick:D},v(e.$t("Max")),1)])]),r("div",ie,[r("span",re,v(e.$t("DaoRedeem.text1")),1),r("span",null,v(f(I)(k.value))+" UCON",1)]),r("div",ve,[r("span",de,v(e.$t("DaoRedeem.text2")),1),r("span",null,v(f(I)(s.value.stakeUCON))+" UCON",1)]),b.value?(u(),i("div",me,v(e.$t("DaoRedeem.text3",{value:f(I)(k.value)})),1)):x("",!0),a[1]||(a[1]=r("div",{class:"border"},null,-1)),r("div",pe,v(e.$t("DaoRedeem.text4",{day:f(t).dayUnstake,rate:f(O)(f(t).daoSystemInfo.dayUnstakeRate)})),1),r("div",fe,v(e.$t("DaoRedeem.text5")),1),m(n,{fee:f(t).daoSystemInfo.unstakeBurnUcon},null,8,["fee"]),r("div",{class:d(["btn-confirm",{btcActive:g.value}]),onClick:R},v(e.$t("Confirm")),3)]),default:p(()=>[c.value?(u(),w(le,{key:1})):(u(),i("div",{key:0,class:d(["btn",{"btn-active":!c.value}])},[r("span",ne,v(e.$t("DaoRedeem.title")),1)],2))]),_:1},8,["title","disabled"])}}}),[["__scopeId","data-v-4dea1465"]]),be={class:"text"},we={key:0,class:"input"},xe={class:"input-title"},Ue={class:"number"},ye={key:1},Se={class:"cell"},ge={class:"cell-label"},he={class:"cell"},$e={class:"cell-label"},De={class:"cell"},Ce={class:"cell-label"},Ie={class:"cell"},Re={class:"cell-label"},_e={class:"input"},Ne={class:"input-title"},Oe={class:"number number2"},Be=b(t({__name:"Redeem2Dialog",emits:["change","max"],setup(e,{emit:a}){const t=N(),n=o(()=>t.daoSystemInfo),s=o(()=>t.accountInfo),{withdrawUnstakeUcon:c}=_(),k=l(null),b=o(()=>{const{blockFlag:e}=t.accountInfo;return!t.isRedeem||"0"!==e}),U=o(()=>{const{blockFlag:e,avaiUnstakeUcon:a}=t.accountInfo;return"0"!==a}),y=o(()=>{const{totalUnstakeUcon:e,pendingUnstakeUcon:a}=s.value;return new h(e).minus(a).toString(10)}),S=o(()=>{const{totalUnstakeUcon:e,pendingUnstakeUcon:a}=s.value;return"0"===e?"0":new h(y.value).div(e).times(new h(100)).decimalPlaces(2).toString(10)}),g=o(()=>{const{dayUnstakeRate:e}=n.value,{unstakeStartTime:a}=s.value,t=new h(1e18).div(new h(e));let l=new h(a).plus(t.times(new h(j))).toString(10);return R(l,"YYYY-MM-DD HH:mm:ss")}),$=o(()=>{const{dayUnstakeRate:e}=n.value;return new h(100).minus(S.value).div(new h(e).div(new h(1e16))).toString(10)}),D=o(()=>"0"!==s.value.avaiUnstakeUcon);async function C(){D.value&&(await c(t.daoSystemInfo.unstakeWithdrawBurnUcon),k.value?.handleClose(),t.getSystemInfo())}const O=o(()=>"0"!=s.value.totalUnstakeUcon&&"0"!=s.value.pendingUnstakeUcon);return(e,a)=>{const l=T;return u(),w(F,{ref_key:"el",ref:k,title:e.$t("DaoRedeem.title1")+" 2/2",classText:"stake-btn",disabled:b.value,height:O.value?"80%":"50%"},{content:p(()=>["0"!=s.value.totalUnstakeUcon?(u(),i("div",we,[r("div",xe,v(e.$t("DaoRedeem.text7")),1),r("span",Ue,v(f(I)(s.value.totalUnstakeUcon))+" UCON ",1)])):x("",!0),O.value?(u(),i("div",ye,[r("div",Se,[a[0]||(a[0]=r("span",{class:"icon cell-icon icon-dao-20"},null,-1)),r("span",ge,v(e.$t("DaoRedeem.text8")),1),r("span",null,v(f(R)(s.value.unstakeStartTime,"YYYY-MM-DD HH:mm:ss")),1)]),r("div",he,[a[1]||(a[1]=r("span",{class:"icon cell-icon icon-dao-22"},null,-1)),r("span",$e,v(e.$t("DaoRedeem.text9")),1),r("span",null,v(g.value),1)]),r("div",De,[a[2]||(a[2]=r("span",{class:"icon cell-icon icon-dao-21"},null,-1)),r("span",Ce,v(e.$t("DaoRedeem.text10")),1),r("span",null,v(f(I)(y.value))+" UCON ("+v(S.value)+"%)",1)]),r("div",Ie,[a[3]||(a[3]=r("span",{class:"icon cell-icon icon-dao-19"},null,-1)),r("span",Re,v(e.$t("DaoRedeem.text11")),1),r("span",null,v(f(I)(s.value.pendingUnstakeUcon))+" UCON("+v(e.$t("DaoRedeem.text14",{day:"0"===s.value.totalUnstakeUcon?"0":$.value}))+") ",1)]),a[4]||(a[4]=r("div",{class:"border"},null,-1))])):x("",!0),r("div",_e,[r("div",Ne,v(e.$t("DaoRedeem.text12")),1),r("span",Oe,v(f(I)(s.value.avaiUnstakeUcon))+" UCON ",1)]),m(l,{fee:f(t).daoSystemInfo.unstakeWithdrawBurnUcon},null,8,["fee"]),r("div",{class:d(["btn-confirm",{"btn-active":D.value}]),onClick:C},v(e.$t("DaoRedeem.text13")),3)]),default:p(()=>[b.value?(u(),w(le,{key:1})):(u(),i("div",{key:0,class:d(["btn",{"btn-active":!b.value,"btn-avai":U.value}])},[r("span",be,v(e.$t("DaoRedeem.title")),1)],2))]),_:1},8,["title","disabled","height"])}}}),[["__scopeId","data-v-84fad9b6"]]),je={class:"text"},Fe={class:"text"},Te=b(t({__name:"RefreshGlobal",setup(e){const a=N(),{flushAccountStatus:t}=_(),n=l(null);async function s(){await t(a.daoSystemInfo.shareRewardBurnUcon),a.getSystemInfo(),n.value?.handleClose()}return(e,t)=>{const l=T;return u(),w(F,{title:e.$t("V1.Refresh"),classText:"stake-btn",disabled:!1,height:"60%",ref_key:"el",ref:n},{content:p(()=>[t[0]||(t[0]=r("i",{class:"icon icon-large icon-dao-17"},null,-1)),r("div",je,v(e.$t("Dao.text10")),1),r("div",Fe,v(e.$t("Dao.text11")),1),m(l,{fee:f(a).daoSystemInfo.voteProposalBurnUcon},null,8,["fee"]),r("div",{class:d(["btn-confirm",{btcActive:!0}]),onClick:s},v(e.$t("Confirm")),1)]),default:p(()=>[t[1]||(t[1]=r("i",{class:"icon icon-dao-17"},null,-1))]),_:1},8,["title"])}}}),[["__scopeId","data-v-fe3a8a4b"]]),Ee={class:"pa"},Pe={class:"title"},Ve={class:"number"},Ye={class:"desc"},Ae={class:"number"},Me={key:0},He={class:"table","w-full":""},We={class:"table-title w-full","w-full":""},Ge={class:"table-cell"},Le={class:"table-cell1"},qe={class:"set"},ze={class:"set-item"},Je={class:"set-item-left"},Ke={class:"label"},Qe={class:"number",style:{"margin-left":"10px"}},Xe={class:"set-item-right"},Ze={class:"set-item"},ea={class:"bonus-detail-content-title2 flex"},aa={class:"mr-10px"},ta={key:0},la={class:"manage"},na=b(t({__name:"Bonus",setup(a){let t=h.clone({ROUNDING_MODE:4});const l=e(),n=U(),s=N(),c=o(()=>s.accountInfo),p=o(()=>c.value.voteDetail.slice(0,4)),b=o(()=>c.value.voteDetail),g=o(()=>{let e=[];return l.stakeList.forEach(a=>{let{level:t}=a;e.push(parseInt(t))}),e=e.sort(),e}),$=o(()=>{let e=new t("0");for(let a=0;a<3;a++)e=e.plus(_(b.value[a+1],18));return"0"===e.toString(10)?"0":e.times(100).dividedBy(_(p.value[0],18)).toString(10)}),D=o(()=>{let e=new t("0");return e=e.plus(_(b.value[4],18)),new t(e).times(100).dividedBy(_(p.value[0],18)).toString(10)}),C=o(()=>{const{totalVote:e}=s.daoSystemInfo,a=c.value.totalVote;if("0"===e)return"0";return new t(a).div(new t(1e18)).decimalPlaces(0).toString(10)}),R=o(()=>{let e=new t("0");return p.value.forEach(a=>{e=e.plus(new t(a))}),e.toString(10)});function _(e,a){const l=C.value,{stakeUCON:n,totalVote:s}=c.value;if("0"===s)return"0";new t(e).times(l).dividedBy(R.value);return new t(e).times(n).dividedBy(new t(1e36)).decimalPlaces(a||0).toString(10)}return o(()=>new t(C.value).div(100).div(new t(R.value).dividedBy(new t(1e18))).decimalPlaces(10).toString(10)),(e,a)=>(u(),i("div",Ee,[r("h4",Pe,[a[1]||(a[1]=r("i",{class:"icon icon-dao-6"},null,-1)),r("span",null,v(e.$t("Share.title1")),1),r("span",Ve,v(f(C)),1)]),a[4]||(a[4]=r("div",null,null,-1)),r("h5",Ye,[a[3]||(a[3]=r("i",{class:"icon icon-dao-24"},null,-1)),r("span",null,v(e.$t("Dao.text14")),1),r("span",Ae,[y(v(f($)),1),f(b)&&0!=f(b)[4]?(u(),i("span",Me,"+"+v(f(D)),1)):x("",!0),a[2]||(a[2]=y("%",-1))])]),r("div",He,[r("h4",We,[y(v(e.$t("Share.text2"))+" ",1),m(Te)])]),r("div",Ge,[r("span",null,v(e.$t("Share.text3")),1),r("span",null,v(e.$t("Share.text4")),1),r("span",null,v(e.$t("Share.text5")),1),r("span",null,v(e.$t("Share.text6")),1)]),r("div",Le,[(u(!0),i(k,null,S(f(p),e=>(u(),i("span",null,v(_(e)),1))),256))]),r("div",qe,[r("div",ze,[r("div",Je,[r("span",Ke,v(e.$t("Share.text7")),1),r("span",Qe,v(f(I)(f(c).stakeUCON)),1)]),r("div",Xe,[m(K),"0"===f(s).accountInfo.pendingUnstakeUcon&&"0"===f(s).accountInfo.avaiUnstakeUcon&&"0"===f(s).accountInfo.processCount?(u(),w(ke,{key:0})):(u(),w(Be,{key:1}))])]),r("div",Ze,[r("h4",ea,[r("span",aa,v(e.$t("Dao.text15")),1),(u(!0),i(k,null,S(f(g),e=>(u(),i("i",{class:d(["icon","icon-u"+(e+1)])},null,2))),256)),0===f(g).length?(u(),i("span",ta,"N/A")):x("",!0)]),r("div",{class:"set-item-right",onClick:a[0]||(a[0]=e=>f(n).replace({name:"Nft"}))},[r("span",la,v(e.$t("Share.text11")),1)])])])]))}}),[["__scopeId","data-v-1d81dbe7"]]);export{na as default};
