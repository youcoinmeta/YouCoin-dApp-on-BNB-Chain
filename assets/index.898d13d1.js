import{c as e,t as a,n as t,q as i,x as l,w as s}from"./index.2d8e1d32.js";import{u as o,r as n,m as r,s as u,e as v}from"./index.a3dc26ea.js";import{a as c,u as p,w as h,b as f,o as d,i as g,p as m}from"./index.ac434ad5.js";import{d as w,r as x,B as b,f as y,k as C,l as $,C as z,D as M,E as S,g as T,P as j}from"./index.242d413d.js";const[k,D]=e("swipe"),I={loop:a,width:t,height:t,vertical:Boolean,autoplay:i(0),duration:i(500),touchable:a,lazyRender:Boolean,initialSwipe:i(0),indicatorColor:String,showIndicators:a,stopPropagation:a},O=Symbol(k);const P=s(w({name:k,props:I,emits:["change"],setup(e,{emit:a,slots:t}){const i=x(),s=x(),v=b({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),w=c(),{children:k,linkChildren:I}=o(O),P=y((()=>k.length)),X=y((()=>v[e.vertical?"height":"width"])),Y=y((()=>e.vertical?w.deltaY.value:w.deltaX.value)),B=y((()=>{if(v.rect){return(e.vertical?v.rect.height:v.rect.width)-X.value*P.value}return 0})),E=y((()=>X.value?Math.ceil(Math.abs(B.value)/X.value):P.value)),R=y((()=>P.value*X.value)),q=y((()=>(v.active+P.value)%P.value)),A=y((()=>{const a=e.vertical?"vertical":"horizontal";return w.direction.value===a})),H=y((()=>{const a={transitionDuration:`${v.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${v.offset}px)`};if(X.value){const t=e.vertical?"height":"width",i=e.vertical?"width":"height";a[t]=`${R.value}px`,a[i]=e[i]?`${e[i]}px`:""}return a})),W=(a,t=0)=>{let i=a*X.value;e.loop||(i=Math.min(i,-B.value));let s=t-i;return e.loop||(s=l(s,B.value,0)),s},F=({pace:t=0,offset:i=0,emitChange:s})=>{if(P.value<=1)return;const{active:o}=v,n=(a=>{const{active:t}=v;return a?e.loop?l(t+a,-1,P.value):l(t+a,0,E.value):t})(t),r=W(n,i);if(e.loop){if(k[0]&&r!==B.value){const e=r<B.value;k[0].setOffset(e?R.value:0)}if(k[P.value-1]&&0!==r){const e=r>0;k[P.value-1].setOffset(e?-R.value:0)}}v.active=n,v.offset=r,s&&n!==o&&a("change",q.value)},G=()=>{v.swiping=!0,v.active<=-1?F({pace:P.value}):v.active>=P.value&&F({pace:-P.value})},J=()=>{G(),w.reset(),u((()=>{v.swiping=!1,F({pace:1,emitChange:!0})}))};let K;const L=()=>clearTimeout(K),N=()=>{L(),e.autoplay>0&&P.value>1&&(K=setTimeout((()=>{J(),N()}),+e.autoplay))},Q=(a=+e.initialSwipe)=>{if(!i.value)return;const t=()=>{var t,l;if(!g(i)){const a={width:i.value.offsetWidth,height:i.value.offsetHeight};v.rect=a,v.width=+(null!=(t=e.width)?t:a.width),v.height=+(null!=(l=e.height)?l:a.height)}P.value&&(a=Math.min(P.value-1,a)),v.active=a,v.swiping=!0,v.offset=W(a),k.forEach((e=>{e.setOffset(0)})),N()};g(i)?j().then(t):t()},U=()=>Q(v.active);let V;const Z=a=>{e.touchable&&(w.start(a),V=Date.now(),L(),G())},_=()=>{if(!e.touchable||!v.swiping)return;const a=Date.now()-V,t=Y.value/a;if((Math.abs(t)>.25||Math.abs(Y.value)>X.value/2)&&A.value){const a=e.vertical?w.offsetY.value:w.offsetX.value;let t=0;t=e.loop?a>0?Y.value>0?-1:1:0:-Math[Y.value>0?"ceil":"floor"](Y.value/X.value),F({pace:t,emitChange:!0})}else Y.value&&F({pace:0});v.swiping=!1,N()},ee=(a,t)=>{const i=t===q.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return T("i",{style:l,class:D("indicator",{active:i})},null)};return p({prev:()=>{G(),w.reset(),u((()=>{v.swiping=!1,F({pace:-1,emitChange:!0})}))},next:J,state:v,resize:U,swipeTo:(a,t={})=>{G(),w.reset(),u((()=>{let i;i=e.loop&&a===P.value?0===v.active?0:a:a%P.value,t.immediate?u((()=>{v.swiping=!1})):v.swiping=!1,F({pace:i-v.active,emitChange:!0})}))}}),I({size:X,props:e,count:P,activeIndicator:q}),C((()=>e.initialSwipe),(e=>Q(+e))),C(P,(()=>Q(v.active))),C((()=>e.autoplay),N),C([h,f],U),C(n(),(e=>{"visible"===e?N():L()})),$(Q),z((()=>Q(v.active))),d((()=>Q(v.active))),M(L),S(L),r("touchmove",(a=>{if(e.touchable&&v.swiping&&(w.move(a),A.value)){!e.loop&&(0===v.active&&Y.value>0||v.active===P.value-1&&Y.value<0)||(m(a,e.stopPropagation),F({offset:Y.value}))}}),{target:s}),()=>{var a;return T("div",{ref:i,class:D()},[T("div",{ref:s,style:H.value,class:D("track",{vertical:e.vertical}),onTouchstartPassive:Z,onTouchend:_,onTouchcancel:_},[null==(a=t.default)?void 0:a.call(t)]),t.indicator?t.indicator({active:q.value,total:P.value}):e.showIndicators&&P.value>1?T("div",{class:D("indicators",{vertical:e.vertical})},[Array(P.value).fill("").map(ee)]):void 0])}}})),[X,Y]=e("swipe-item");const B=s(w({name:X,setup(e,{slots:a}){let t;const i=b({offset:0,inited:!1,mounted:!1}),{parent:l,index:s}=v(O);if(!l)return;const o=y((()=>{const e={},{vertical:a}=l.props;return l.size.value&&(e[a?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${a?"Y":"X"}(${i.offset}px)`),e})),n=y((()=>{const{loop:e,lazyRender:a}=l.props;if(!a||t)return!0;if(!i.mounted)return!1;const o=l.activeIndicator.value,n=l.count.value-1,r=0===o&&e?n:o-1,u=o===n&&e?0:o+1;return t=s.value===o||s.value===r||s.value===u,t}));return $((()=>{j((()=>{i.mounted=!0}))})),p({setOffset:e=>{i.offset=e}}),()=>{var e;return T("div",{class:Y(),style:o.value},[n.value?null==(e=a.default)?void 0:e.call(a):null])}}}));export{B as S,P as a};
