import{c as e,t as a,n as t,q as i,x as l,w as s}from"./index.77de6298.js";import{u as o,r as n,m as r,s as u,e as v}from"./index.d2c68f4f.js";import{a as c,u as h,w as f,b as d,o as p,i as g,p as m}from"./index.903be1c9.js";import{d as w,r as x,z as b,f as y,k as C,l as z,A as S,B as $,C as M,g as T,R as j}from"./index.2cf58b4a.js";const[k,I]=e("swipe"),O={loop:a,width:t,height:t,vertical:Boolean,autoplay:i(0),duration:i(500),touchable:a,lazyRender:Boolean,initialSwipe:i(0),indicatorColor:String,showIndicators:a,stopPropagation:a},X=Symbol(k);const Y=s(w({name:k,props:O,emits:["change","dragStart","dragEnd"],setup(e,{emit:a,slots:t}){const i=x(),s=x(),v=b({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let w=!1;const k=c(),{children:O,linkChildren:Y}=o(X),B=y(()=>O.length),D=y(()=>v[e.vertical?"height":"width"]),E=y(()=>e.vertical?k.deltaY.value:k.deltaX.value),P=y(()=>{if(v.rect){return(e.vertical?v.rect.height:v.rect.width)-D.value*B.value}return 0}),R=y(()=>D.value?Math.ceil(Math.abs(P.value)/D.value):B.value),A=y(()=>B.value*D.value),q=y(()=>(v.active+B.value)%B.value),F=y(()=>{const a=e.vertical?"vertical":"horizontal";return k.direction.value===a}),H=y(()=>{const a={transitionDuration:`${v.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+v.offset.toFixed(2)}px)`};if(D.value){const t=e.vertical?"height":"width",i=e.vertical?"width":"height";a[t]=`${A.value}px`,a[i]=e[i]?`${e[i]}px`:""}return a}),W=(a,t=0)=>{let i=a*D.value;e.loop||(i=Math.min(i,-P.value));let s=t-i;return e.loop||(s=l(s,P.value,0)),s},G=({pace:t=0,offset:i=0,emitChange:s})=>{if(B.value<=1)return;const{active:o}=v,n=(a=>{const{active:t}=v;return a?e.loop?l(t+a,-1,B.value):l(t+a,0,R.value):t})(t),r=W(n,i);if(e.loop){if(O[0]&&r!==P.value){const e=r<P.value;O[0].setOffset(e?A.value:0)}if(O[B.value-1]&&0!==r){const e=r>0;O[B.value-1].setOffset(e?-A.value:0)}}v.active=n,v.offset=r,s&&n!==o&&a("change",q.value)},J=()=>{v.swiping=!0,v.active<=-1?G({pace:B.value}):v.active>=B.value&&G({pace:-B.value})},K=()=>{J(),k.reset(),u(()=>{v.swiping=!1,G({pace:1,emitChange:!0})})};let L;const N=()=>clearTimeout(L),Q=()=>{N(),+e.autoplay>0&&B.value>1&&(L=setTimeout(()=>{K(),Q()},+e.autoplay))},U=(a=+e.initialSwipe)=>{if(!i.value)return;const t=()=>{var t,l;if(!g(i)){const a={width:i.value.offsetWidth,height:i.value.offsetHeight};v.rect=a,v.width=+(null!=(t=e.width)?t:a.width),v.height=+(null!=(l=e.height)?l:a.height)}B.value&&-1===(a=Math.min(B.value-1,a))&&(a=B.value-1),v.active=a,v.swiping=!0,v.offset=W(a),O.forEach(e=>{e.setOffset(0)}),Q()};g(i)?j().then(t):t()},V=()=>U(v.active);let Z;const _=a=>{!e.touchable||a.touches.length>1||(k.start(a),w=!1,Z=Date.now(),N(),J())},ee=()=>{if(!e.touchable||!v.swiping)return;const t=Date.now()-Z,i=E.value/t;if((Math.abs(i)>.25||Math.abs(E.value)>D.value/2)&&F.value){const a=e.vertical?k.offsetY.value:k.offsetX.value;let t=0;t=e.loop?a>0?E.value>0?-1:1:0:-Math[E.value>0?"ceil":"floor"](E.value/D.value),G({pace:t,emitChange:!0})}else E.value&&G({pace:0});w=!1,v.swiping=!1,a("dragEnd",{index:q.value}),Q()},ae=(a,t)=>{const i=t===q.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return T("i",{style:l,class:I("indicator",{active:i})},null)};return h({prev:()=>{J(),k.reset(),u(()=>{v.swiping=!1,G({pace:-1,emitChange:!0})})},next:K,state:v,resize:V,swipeTo:(a,t={})=>{J(),k.reset(),u(()=>{let i;i=e.loop&&a===B.value?0===v.active?0:a:a%B.value,t.immediate?u(()=>{v.swiping=!1}):v.swiping=!1,G({pace:i-v.active,emitChange:!0})})}}),Y({size:D,props:e,count:B,activeIndicator:q}),C(()=>e.initialSwipe,e=>U(+e)),C(B,()=>U(v.active)),C(()=>e.autoplay,Q),C([f,d,()=>e.width,()=>e.height],V),C(n(),e=>{"visible"===e?Q():N()}),z(U),S(()=>U(v.active)),p(()=>U(v.active)),$(N),M(N),r("touchmove",t=>{if(e.touchable&&v.swiping&&(k.move(t),F.value)){!e.loop&&(0===v.active&&E.value>0||v.active===B.value-1&&E.value<0)||(m(t,e.stopPropagation),G({offset:E.value}),w||(a("dragStart",{index:q.value}),w=!0))}},{target:s}),()=>{var a;return T("div",{ref:i,class:I()},[T("div",{ref:s,style:H.value,class:I("track",{vertical:e.vertical}),onTouchstartPassive:_,onTouchend:ee,onTouchcancel:ee},[null==(a=t.default)?void 0:a.call(t)]),t.indicator?t.indicator({active:q.value,total:B.value}):e.showIndicators&&B.value>1?T("div",{class:I("indicators",{vertical:e.vertical})},[Array(B.value).fill("").map(ae)]):void 0])}}})),[B,D]=e("swipe-item");const E=s(w({name:B,setup(e,{slots:a}){let t;const i=b({offset:0,inited:!1,mounted:!1}),{parent:l,index:s}=v(X);if(!l)return;const o=y(()=>{const e={},{vertical:a}=l.props;return l.size.value&&(e[a?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${a?"Y":"X"}(${i.offset}px)`),e}),n=y(()=>{const{loop:e,lazyRender:a}=l.props;if(!a||t)return!0;if(!i.mounted)return!1;const o=l.activeIndicator.value,n=l.count.value-1,r=0===o&&e?n:o-1,u=o===n&&e?0:o+1;return t=s.value===o||s.value===r||s.value===u,t});return z(()=>{j(()=>{i.mounted=!0})}),h({setOffset:e=>{i.offset=e}}),()=>{var e;return T("div",{class:D(),style:o.value},[n.value?null==(e=a.default)?void 0:e.call(a):null])}}}));export{E as S,Y as a};
