import{g as e,s as t,F as a,u as l,p as r,r as n}from"./index.1e048e1d.js";import{c as i,m as o,b as s,t as u,u as c,e as d,d as g,I as f,w as p,h as v,a as m,j as b,k as h,l as y,o as k,p as x}from"./index.fddaed59.js";import{K as w,d as S,g as C,B,r as V,f as I,G as M,k as L,L as P,l as $,J as A,a as j}from"./index.16dbb63b.js";import{k as z,d as E,C as T}from"./index.6d7a3683.js";const q={to:[String,Object],url:String,replace:Boolean};function D(){const e=w().proxy;return()=>function({to:e,url:t,replace:a,$router:l}){e&&l?l[a?"replace":"push"](e):t&&(a?location.replace(t):location.href=t)}(e)}let W=0;const[F,H]=i("cell"),O={tag:o("div"),icon:String,size:String,title:s,value:s,label:s,center:Boolean,isLink:Boolean,border:u,required:Boolean,iconPrefix:String,valueClass:c,labelClass:c,titleClass:c,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}};const R=p(S({name:F,props:d({},O,q),setup(e,{slots:t}){const a=D(),l=()=>{if(t.label||g(e.label))return C("div",{class:[H("label"),e.labelClass]},[t.label?t.label():e.label])},r=()=>{if(t.title||g(e.title))return C("div",{class:[H("title"),e.titleClass],style:e.titleStyle},[t.title?t.title():C("span",null,[e.title]),l()])},n=()=>{const a=t.value||t.default;if(a||g(e.value))return C("div",{class:[H("value"),e.valueClass]},[a?a():C("span",null,[e.value])])},i=()=>{if(t["right-icon"])return t["right-icon"]();if(e.isLink){const t=e.arrowDirection&&"right"!==e.arrowDirection?`arrow-${e.arrowDirection}`:"arrow";return C(f,{name:t,class:H("right-icon")},null)}};return()=>{var l;const{tag:o,size:s,center:u,border:c,isLink:d,required:g}=e,p=null!=(l=e.clickable)?l:d,v={center:u,required:g,clickable:p,borderless:!c};return s&&(v[s]=!!s),C(o,{class:H(v),role:p?"button":void 0,tabindex:p?0:void 0,onClick:a},{default:()=>{var a;return[t.icon?t.icon():e.icon?C(f,{name:e.icon,class:H("left-icon"),classPrefix:e.iconPrefix},null):void 0,r(),n(),i(),null==(a=t.extra)?void 0:a.call(t)]}})}}}));function K(e){return Array.isArray(e)?!e.length:0!==e&&!e}function G(e,t){const{message:a}=t;return b(a)?a(e,t):a||""}function J({target:e}){e.composing=!0}function N({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function Q(e){return[...e].length}const[U,X]=i("field");const Y=p(S({name:U,props:d({},O,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:s,formatter:Function,clearIcon:o("clear"),modelValue:h(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:o("focus"),formatTrigger:o("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:s,type:o("text"),rules:Array,autosize:[Boolean,Object],labelWidth:s,labelClass:c,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(i,{emit:o,slots:s}){const u=function(){const e=w(),{name:t="unknown"}=(null==e?void 0:e.type)||{};return`${t}-${++W}`}(),c=B({status:"unvalidated",focused:!1,validateMessage:""}),d=V(),p=V(),b=V(),{parent:h}=z(a),S=()=>{var e;return String(null!=(e=i.modelValue)?e:"")},q=e=>g(i[e])?i[e]:h&&g(h.props[e])?h.props[e]:void 0,D=I((()=>{const e=q("readonly");if(i.clearable&&!e){const e=""!==S(),t="always"===i.clearTrigger||"focus"===i.clearTrigger&&c.focused;return e&&t}return!1})),F=I((()=>b.value&&s.input?b.value():i.modelValue)),H=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===c.status)return;let{value:e}=F;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(K(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return c.status="failed",void(c.validateMessage=G(e,t));if(t.validator){if(K(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise((a=>{const l=t.validator(e,t);m(l)?l.then(a):a(l)}))}(e,t).then((a=>{a&&"string"==typeof a?(c.status="failed",c.validateMessage=a):!1===a&&(c.status="failed",c.validateMessage=G(e,t))}))}}))),Promise.resolve()),O=()=>{c.status="unvalidated",c.validateMessage=""},U=()=>o("endValidate",{status:c.status,message:c.validateMessage}),Y=(e=i.rules)=>new Promise((t=>{O(),e?(o("startValidate"),H(e).then((()=>{"failed"===c.status?(t({name:i.name,message:c.validateMessage}),U()):(c.status="passed",t(),U())}))):t()})),Z=e=>{if(h&&i.rules){const{validateTrigger:t}=h.props,a=k(t).includes(e),l=i.rules.filter((t=>t.trigger?k(t.trigger).includes(e):a));l.length&&Y(l)}},_=(e,t="onChange")=>{const a=e,l=(e=(e=>{const{maxlength:t}=i;if(g(t)&&Q(e)>t){const a=S();return a&&Q(a)===+t?a:function(e,t){return[...e].slice(0,t).join("")}(e,+t)}return e})(e))!==a;if("number"===i.type||"digit"===i.type){const t="number"===i.type;e=x(e,t,t)}if(i.formatter&&t===i.formatTrigger&&(e=i.formatter(e)),d.value&&d.value.value!==e)if(c.focused&&l){const{selectionStart:t,selectionEnd:a}=d.value;d.value.value=e,d.value.setSelectionRange(t-1,a-1)}else d.value.value=e;e!==i.modelValue&&o("update:modelValue",e)},ee=e=>{e.target.composing||_(e.target.value)},te=()=>{var e;return null==(e=d.value)?void 0:e.blur()},ae=()=>{const a=d.value;"textarea"===i.type&&i.autosize&&a&&function(a,l){const r=e();a.style.height="auto";let n=a.scrollHeight;if(v(l)){const{maxHeight:e,minHeight:t}=l;void 0!==e&&(n=Math.min(n,e)),void 0!==t&&(n=Math.max(n,t))}n&&(a.style.height=`${n}px`,t(r))}(a,i.autosize)},le=e=>{c.focused=!0,o("focus",e),P(ae),q("readonly")&&te()},re=e=>{q("readonly")||(c.focused=!1,_(S(),"onBlur"),o("blur",e),Z("onBlur"),P(ae),n())},ne=e=>o("clickInput",e),ie=e=>o("clickLeftIcon",e),oe=e=>o("clickRightIcon",e),se=I((()=>"boolean"==typeof i.error?i.error:!(!h||!h.props.showError||"failed"!==c.status)||void 0)),ue=I((()=>{const e=q("labelWidth");if(e)return{width:y(e)}})),ce=e=>{if(13===e.keyCode){h&&h.props.submitOnEnter||"textarea"===i.type||r(e),"search"===i.type&&te()}o("keypress",e)},de=()=>i.id||`${u}-input`,ge=()=>{const e=X("control",[q("inputAlign"),{error:se.value,custom:!!s.input,"min-height":"textarea"===i.type&&!i.autosize}]);if(s.input)return C("div",{class:e,onClick:ne},[s.input()]);const t={id:de(),ref:d,name:i.name,rows:void 0!==i.rows?+i.rows:void 0,class:e,disabled:q("disabled"),readonly:q("readonly"),autofocus:i.autofocus,placeholder:i.placeholder,autocomplete:i.autocomplete,enterkeyhint:i.enterkeyhint,"aria-labelledby":i.label?`${u}-label`:void 0,onBlur:re,onFocus:le,onInput:ee,onClick:ne,onChange:N,onKeypress:ce,onCompositionend:N,onCompositionstart:J};return"textarea"===i.type?C("textarea",t,null):C("input",A("number"===(a=i.type)?{type:"text",inputmode:"decimal"}:"digit"===a?{type:"tel",inputmode:"numeric"}:{type:a},t),null);var a},fe=()=>{const e=s["right-icon"];if(i.rightIcon||e)return C("div",{class:X("right-icon"),onClick:oe},[e?e():C(f,{name:i.rightIcon,classPrefix:i.iconPrefix},null)])},pe=()=>{if(i.showWordLimit&&i.maxlength){const e=Q(S());return C("div",{class:X("word-limit")},[C("span",{class:X("word-num")},[e]),j("/"),i.maxlength])}},ve=()=>{if(h&&!1===h.props.showErrorMessage)return;const e=i.errorMessage||c.validateMessage;if(e){const t=s["error-message"],a=q("errorMessageAlign");return C("div",{class:X("error-message",a)},[t?t({message:e}):e])}},me=()=>[C("div",{class:X("body")},[ge(),D.value&&C(f,{ref:p,name:i.clearIcon,class:X("clear")},null),fe(),s.button&&C("div",{class:X("button")},[s.button()])]),pe(),ve()];return l({blur:te,focus:()=>{var e;return null==(e=d.value)?void 0:e.focus()},validate:Y,formValue:F,resetValidation:O,getValidationStatus:()=>c.status}),M(T,{customValue:b,resetValidation:O,validateWithTrigger:Z}),L((()=>i.modelValue),(()=>{_(S()),O(),Z("onChange"),P(ae)})),$((()=>{_(S(),i.formatTrigger),P(ae)})),E("touchstart",(e=>{r(e),o("update:modelValue",""),o("clear",e)}),{target:I((()=>{var e;return null==(e=p.value)?void 0:e.$el}))}),()=>{const e=q("disabled"),t=q("labelAlign"),a=(()=>{const e=q("colon")?":":"";return s.label?[s.label(),e]:i.label?C("label",{id:`${u}-label`,for:de()},[i.label+e]):void 0})(),l=(()=>{const e=s["left-icon"];if(i.leftIcon||e)return C("div",{class:X("left-icon"),onClick:ie},[e?e():C(f,{name:i.leftIcon,classPrefix:i.iconPrefix},null)])})();return C(R,{size:i.size,class:X({error:se.value,disabled:e,[`label-${t}`]:t}),center:i.center,border:i.border,isLink:i.isLink,clickable:i.clickable,titleStyle:ue.value,valueClass:X("value"),titleClass:[X("label",[t,{required:i.required}]),i.labelClass],arrowDirection:i.arrowDirection},{icon:l&&"top"!==t?()=>l:null,title:a||"top"===t?()=>"top"===t?[l,a]:a:null,value:me,extra:s.extra})}}}));export{R as C,Y as F,O as c};
