import{d as e,c as a,e as t,m as o,T as l,f as n}from"./contract.7fcb6f9e.js";import{B as r,C as c,E as s}from"./contract.486685f1.js";import{K as u,f as i,B as d,r as w,k as m,a4 as v,a0 as p,l as f,a1 as g}from"./index.0681fd30.js";import{i as S,n as U}from"./index.0531aba9.js";import{u as h}from"./useUbsV3.11ae6a01.js";import{o as k,E as R}from"./orderBy.f4a193f4.js";const T=18,A="1000000000000000000000000";class b{startTime;uconPerReleaseAmount;uconLastReleaseTime;uconReleaseInterval;triggerFee;withdrawFee;unlockFee;triggerNum;givingBackDAOUcon;givingBackRewardPoolUcon;givingBackFund;total2Share;total2DAO;total2UconFunder;total2SeroFunder;total2SwapUconFrom;nowAvaiBullUSDT;tokenRewardParam;totalSelfReleaseUcon;totalTreeReleaseUcon;totalBullUSDT;totalBreakUsdt;totalBurnUcon;totalBurnSero;burnUCONFee}class B{affLevel;releaseUSD;totalExtraHashRate;directExtraHashRateUSD;id;issueMedalLevel;lastMedalSum;latestMedalLevel;myTarget;pendingUconWithdraw;personHashRateUSD;personHashRateUpdateTime;principalFactor;principalUSD;targetSum;totalAffUconMinnerReward;totalUconMinnerReward;avaiBullReward;totalBreakUsdt;totalBullReward}const{getSysParam:D,getAccount:P}=h(),{getAccountID:x,getUserAccount:y}=e(),F=u("v3",(()=>{const e=a(),u=t(),h=i((()=>e.account)),T=S({time:0,onFinish:()=>{}}),F=d({cur:T.current}),L=w(!1),N=w(new b),C=w(new B),M=w(""),I=w(""),_=w(""),O=w(!1),E=w([]),j=w([]),$=w([]),H=i((()=>{const e=j.value.filter((e=>"0"!==e.TotalStake));return k(e,(e=>new r(e.TotalStake).toNumber()),["desc"])})),z=i((()=>j.value.reduce(((e,a)=>e.plus(a.TotalStake)),new r(0)).toString(10))),V=i((()=>j.value.reduce(((e,a)=>{const t=U(a.TotalStakeAmount,a.maxPrice,a.decimal);return e.plus(t)}),new r(0)).toString(10))),K=i((()=>{const e=j.value.filter((e=>"0"!==e.Release)),{totalBullUSDT:a}=N.value;return"0"!==a&&e.push({name:"USDT",decimal:6,Release:U(a,"1000000","18"),price:"1000000"}),k(e,(e=>new r(e.Release).toNumber()),["desc"])})),W=i((()=>{const e=K.value.reduce(((e,a)=>e.plus(a.Release)),new r(0)),{totalBullUSDT:a}=N.value;return e.plus(new r(a).dividedBy(1e12)).toString(10)})),q=i((()=>{const e=K.value.reduce(((e,a)=>{const t=U(a.TotalReleaseAmount,a.maxPrice,a.decimal);return e.plus(t)}),new r(0)),{totalBullUSDT:a}=N.value;return e.plus(a||"0").toString(10)})),G=i((()=>j.value.reduce(((e,a)=>{const{total2UconFunder:t,total2SeroFunder:o}=a,l=new r(t).plus(new r(o)),n=U(l.toString(10),a.price,a.decimal);return e.plus(n)}),new r(0)).toString(10))),J=i((()=>{const e=j.value.filter((e=>"0"!==e.AvaiReward));return k(e,(e=>new r(e.AvaiReward).toNumber()),["desc"])})),Q=i((()=>{const e=J.value.reduce(((e,a)=>{const{avaiReward:t,price:o}=a,l=U(t||"0",o,a.decimal);return e.plus(l)}),new r(0)),{avaiBullReward:a}=C.value;return e.plus(new r(a||"0").dividedBy(1e12)).toString(10)})),X=i((()=>{const e=j.value.filter((e=>!!e.stakeAmountUSD&&"0"!==e.stakeAmountUSD));return k(e,(e=>new r(e.stakeAmountUSD).toNumber()),["desc"])})),Y=i((()=>X.value.reduce(((e,a)=>e.plus(a.stakeAmountUSD||"0")),new r(0)).toString(10))),Z=i((()=>{const e=j.value.filter((e=>"0"!==e.lockAmount));return k(e,(e=>new r(e.lockAmount).toNumber()),["desc"])})),ee=i((()=>{const{principalFactor:e}=C.value;return e&&"0"!==e?new r(1).dividedBy(new r(e).dividedBy(new r(1e18))).decimalPlaces(2).toString(10):"0"})),ae=i((()=>{if(N.value.tokenRewardParam){const e=N.value.tokenRewardParam.allowThreshold,a=new r(e).comparedTo(new r(I.value||"0"));return-1===a||0===a||1!==a&&a}return!1})),te=i((()=>{const e=j.value.find((e=>"UCON"===e.name));return e?e.price:"0"})),oe=i((()=>{const e=j.value.find((e=>"UCON"===e.name));return e?e.maxPrice:"0"})),le=i((()=>j.value.reduce(((e,a)=>{const{total2UconFunder:t,total2SeroFunder:o}=a,l=U(t,a.maxPrice,a.decimal),n=U(o,a.maxPrice,a.decimal);return e.plus(l).plus(n)}),new r(0)).toString(10))),ne=i((()=>j.value.reduce(((e,a)=>{const t=U(a.bullPool,a.price,a.decimal);return e.plus(t)}),new r(0)).toString(10))),re=i((()=>j.value.reduce(((e,a)=>{const t=U(a.bullPool,a.maxPrice,a.decimal);return e.plus(t)}),new r(0)).toString(10))),ce=i((()=>j.value.reduce(((e,a)=>{const t=U(a.bullPool,a.maxPrice,a.decimal),o=U(a.bullReleased,a.maxPrice,a.decimal);return e.plus(t).plus(o)}),new r(0)).toString(10))),se=i((()=>{const{releaseUSD:e,principalUSD:a}=C.value;return 1===new r(e).comparedTo(new r(a))})),ue=i((()=>{const e=j.value;return k(e,(e=>{const a=new r(U(e.bal||"0",e.price,e.decimal)).toString();return Number(a)}),["desc"])}));function ie(e){const a=l.find((a=>a.addr.toLocaleLowerCase()===e.toLocaleLowerCase()));return a&&a.name}async function de(){const{param:a,tis:t}=await D(!1),l=(new Date).getTime();N.value={...a};const n=t,i=n.length;j.value=[];let d=await x(h.value);const w="0"!==d.id;let m=null;if(w){const a=await y(d.id);M.value=d.id,E.value=a.accountInfo.withdrawAddrs;try{let a=await we();m=await P(e.account,a,!1)}catch(F){}!async function(){const a="https://resource.githnet.com/api";try{const e=await v.get(`${a}/v3/getPow?id=${M.value}`);if(0===e.data.code){I.value=new r(e.data.result.value).toString(10),_.value=new r(e.data.result.directPow).toString(10);const a=N.value.tokenRewardParam.allowThreshold;if(-1===new r(_.value).comparedTo(new r(a))){(localStorage.getItem("showPow")||"-1")!==_.value&&(O.value=!0)}else O.value=!1}}catch(F){const{href:t,version:o,user_agent:l}=g();p({error_code:500,error_message:"",browser_fingerprint:"550e8400-e29b-41d4-a716-446655440000",user_id:e.account,context:{name:"getPow",address:e.account,version:o},user_agent:l,page_url:encodeURIComponent(t)})}}();const{atis:t,aci:o,ai:l}=m,{issueMedalLevel:n,latestMedalLevel:c}=l;u.changeV3(n,c);const{avaiBullReward:s}=l,i=localStorage.getItem("nowAvaiBullUSDT")||"";"0"!==s&&i!=s&&(L.value=!0),C.value={...o,...l}}else C.value=new B;const f=[];for(let e=0;e<i;e++){const{addr:a,expansionFactor:t,decimal:o,price:l,totalStake:c,flag:s,totalAffRelease:u,totalUnlock:i}=n[e];let d=Math.log10(Number(o)).toString(10);const v=U(c,l,d),p=c,g=ie(a),{totalSelfReleaseUcon:S,totalTreeReleaseUcon:h}=N.value,k="UCON"===g?new r(u).plus(i).plus(S).plus(h).toString(10):new r(u).plus(i).toString(10),R=U(k,l,d),T=k,A=1===new r(t).comparedTo(new r(10).exponentiatedBy(18)),b="1"===s;if(w){const{atis:a}=m,{avaiReward:t,totalStake:o,totalStakeUSD:r,lockAmount:c}=a[e],s=U(t,l,d);f.push({...n[e],name:g,isArrow:A,TotalStakeAmount:p,TotalStake:v,...a[e],TotalReleaseAmount:T,Release:R,AvaiReward:s,decimal:d,isPos:b,userTotalStake:o,userTotalStakeUSD:r,lockAmount:c})}else f.push({...n[e],name:g,isArrow:A,TotalStakeAmount:p,TotalStake:v,TotalReleaseAmount:T,Release:R,AvaiReward:"0",decimal:d,isPos:b,userTotalStake:"0",userTotalStakeUSD:"0",lockAmount:"0"})}j.value=f;const{uconLastReleaseTime:S,uconReleaseInterval:k}=N.value;new r(S).plus(new r(k)).toString(10);const R=Math.ceil((new Date).getTime()/1e3);let A=Math.floor(R/Number(k))*Number(k)+Number(k);A-Number(S)<Number(k)&&(A+=Number(k));const b=1e3*A-l;T.reset(Number(b)),T.start(),async function(){const e=j.value,a=e.length,t="0xF882368B672290f174D57C1c0A1ac4Fc21525C87",l=[],n=[];for(let o=0;o<a;o++){const{addr:a}=e[o],r=new c(s,a,"v3 getTokenBal"),u=await r.callData("balanceOf",[h.value]),i=await r.callData("allowance",[h.value,t]);l.push(u),n.push(i)}const r=await o.multicall(l),u=await o.multicall(n);for(let o=0;o<a;o++)e[o].bal=r[o][0],e[o].approve=u[o][0]}()}async function we(a){try{const e="https://resource.githnet.com/api",t=a?`?id=${M.value}&type=1`:`?id=${M.value}`,o=await v.get(`${e}/v3/getSignData${t}`);if(0===o.data.code)return o.data.result;if(!a){const e=(new Date).getTime(),a=Math.floor(e/1e3),t=new Array(20).fill("0");return[[a.toString(),t],"0x28694e88ad553b0d79adaf40dce5f6bcf3a12ae105a938386021dff729d8dc8c0e6dcae1b8d9a09ff3709f77d1744381ac3927cd4ea201279518a863f42fa6ec1b"]}throw new Error("error code: 4001")}catch(t){if(!a){const a=(new Date).getTime(),o=Math.floor(a/1e3),l=new Array(20).fill("0");let n=[[o.toString(),l],"0x28694e88ad553b0d79adaf40dce5f6bcf3a12ae105a938386021dff729d8dc8c0e6dcae1b8d9a09ff3709f77d1744381ac3927cd4ea201279518a863f42fa6ec1b"];const{href:r,version:c,user_agent:s}=g();return t.stack,p({error_code:500,error_message:"",browser_fingerprint:"550e8400-e29b-41d4-a716-446655440000",user_id:e.account,context:{name:"getInputData",address:e.account,version:c},user_agent:s,page_url:encodeURIComponent(r)}),n}throw new Error("error code: 5001")}}m(h,(async e=>{e&&de()}));const me=w({pageSize:20,pageNum:1}),ve=w(!1);return f((async()=>{h.value&&de()})),{showBull:L,totalStakeUsdt:z,totalStakeUsdtMax:V,totalReleaseUsdt:W,totalReleaseUsdtMax:q,givingBackFund:G,givingBackFundMax:le,posList:$,current:F,tokenList:j,avaiRewardList:J,totalAvaiReward:Q,systemInfo:N,userTotalStake:Y,uconPrice:te,uconPriceMax:oe,account:h,accountInfo:C,principalFactor:ee,stakeList:H,stakeUserList:X,unlockUserList:Z,releaseList:K,selectTokenList:ue,withdrawAddrs:E,accountPow:I,directPow:_,isShowPos:ae,isUnlockType:se,totalBull:ne,totalBullMax:re,totalBullMax1:ce,accountID:M,getSystemInfo:de,closeBull:function(e){e&&localStorage.setItem("nowAvaiBullUSDT",C.value.avaiBullReward),L.value=!1},closePow:function(e){e&&localStorage.setItem("showPow",_.value||"0"),O.value=!1},getInputDate:we,getBalApprove:async function(e){const a=new R(e),t=h.value;return{bal:await a.call("balanceOf",[h.value]),approve:await a.call("allowance",[t,"0xF882368B672290f174D57C1c0A1ac4Fc21525C87"])}},setApprove:async function(e){const a=new R(e),t="SERO"===ie(e)?"10000000000000000000000000":A;try{const o=j.value.findIndex((a=>a.addr===e));if(o>-1){await a.execute("approve",["0xF882368B672290f174D57C1c0A1ac4Fc21525C87",t]);const e=h.value,l="0xF882368B672290f174D57C1c0A1ac4Fc21525C87",n=await a.call("allowance",[e,l]);j.value[o].approve=n;return await a.call("allowance",[e,l])}}catch(o){}},updateTokenBal:async function(e,a){const t=j.value.findIndex((a=>a.addr.toLocaleLowerCase()===e.toLocaleLowerCase()));if(t>-1){const a=new R(e),o=await a.call("balanceOf",[h.value]);j.value[t].bal=o}},getPosList:async function(){const e=(await v.post("https://resource.githnet.com/api/v3/getPosList",me.value)).data.result;me.value.pageNum++;for(let t=0;t<e.length;t++)try{const a=n(e[t].txHash);$.value.push({...a,timestamp:e[t].createTime})}catch(a){throw new Error(a)}e.length>=me.value.pageSize?ve.value=!0:ve.value=!1},resetPos:function(){$.value=[],me.value.pageNum=1},isMore:ve,showPow:O}}));export{A as T,T as U,F as u};
