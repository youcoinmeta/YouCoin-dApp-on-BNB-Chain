import{u as a,R as e,B as t,W as n,X as o,k as s}from"./index.6fade032.js";import{W as c,P as r,r as u,c as l,i}from"./index.b89f3217.js";import{u as w,j as d}from"./contract.a810471f.js";import{u as p}from"./tip.4de707e2.js";const f=p();function m(n){const o=a();return{getUconBalance:async function(a){const s=await e.call("balanceOf",[o.account]),c=await e.call("allowance",[o.account,n]),r=-1===new t(c).comparedTo(new t(a)),u=!(-1===new t(s).comparedTo(new t(a)));return r?(f.changeDao(!0),!1):(u||f.changeDao(!1),u)}}}const{getUconBalance:v}=m("0x84EF0D09F9Ba4239976CC68cD6e549b5c8729dc1"),U=a();function h(){return w(),{getSysParam:async function(a){const e=await n.call("getSysParam",[]);let{marketOut:t,daoShareOut:s,totalInUcon:c,avaiUcon:r}=e;const u=await o.call("getAll",[a]);let{minStakeUcon:l,dayUnstakeRate:i,unstakeBurnUcon:w,unstakeWithdrawBurnUcon:d,maxRunningProposal:p,commitProposalBurnUcon:f,finishProposalReward:m,shareRewardBurnUcon:v,totalStakeUcon:U,shareTimes:h,totalVote:k,uconStakeIncrease:P,medalIncreaseRate:R,proposalIncreaseRate:S,fullProposalIncreaseRate:y,totalShareReward:g,voteProposalBurnUcon:x}=u.param;return{minStakeUcon:l,dayUnstakeRate:i,unstakeBurnUcon:w,unstakeWithdrawBurnUcon:d,maxRunningProposal:p,voteProposalBurnUcon:x,commitProposalBurnUcon:f,finishProposalReward:m,shareRewardBurnUcon:v,totalStakeUcon:U,shareTimes:h,totalVote:k,uconStakeIncrease:P,medalIncreaseRate:R,proposalIncreaseRate:S,fullProposalIncreaseRate:y,totalShareReward:g,marketOut:t,daoShareOut:s,totalInUcon:c,avaiUcon:r}},getAccount:async function(a){const e=await o.call("getAll",[a]),{ai:t,processCount:n}=e;return{...t,processCount:n}},getProposalList:async function(a,e,t){return await o.call("getProposalList",[a,t,e])},getAccountProposal:async function(a,e,t){return await o.call("getAccountProposal",[a,t,e])},isRole:async function(){return await d(U.account)},stakeUcon:async function(a){await o.execute("stakeUCON",[a])},unstakeUcon:async function(a,e){await v(e)&&await o.execute("unstakeUCON",[a])},withdrawUnstakeUcon:async function(a){await v(a)&&await o.execute("withdrawUnstakeUcon",[])},submitProposal:async function(a,e,t,n,s,c,r){await v(c)&&await o.execute("submitProposaldixczv",[[a,e,t,n,s],r])},voteProposal:async function(a,e,t){await o.execute("voteProposalasdfxzcv",[a,e,t])},flushProcessProposal:async function(a,e){await o.execute("flushProcessProposal",[a,e])},finishProposal:async function(a){await o.execute("finishProposalasdfzxcv",[a])},withdrawShareReward:async function(a){await v(a)&&await o.execute("withdrawShareReward",[])},flushAccountStatus:async function(a){await v(a)&&await o.execute("flushAccountStatus",[U.account,"0x0000000000000000000000000000000000000000000000000000000000000000","10"])},CancelProposal:async function(a){await o.execute("CancelProposal",[a])},RecoveryHideProposal:async function(a){await o.execute("RecoveryHideProposal",[a])}}}new c;const k="0x35867f9e6c4fc47417f2f795eba6eb7f71dd6647351ab9ec723bbce399915b0a",{getSysParam:P,getAccount:R,getProposalList:S,getAccountProposal:y}=h(),g=r("dao",(()=>{const e=u(1),n=u(!0),o=u(!0),c=u("10"),r=u(!1),w=u(!1),d=a(),p=l((()=>d.account)),f=u({totalStakeUcon:"0",marketOut:"0",daoShareOut:"0",totalInUcon:"0",avaiUcon:"0",dayUnstakeRate:"0",totalVote:"0",shareTimes:"0",totalShareReward:"0",commitProposalBurnUcon:"0",unstakeBurnUcon:"0",unstakeWithdrawBurnUcon:"0",shareRewardBurnUcon:"0",uconStakeIncrease:[],medalIncreaseRate:[],minStakeUcon:"0",proposalIncreaseRate:"0",fullProposalIncreaseRate:"0",finishProposalReward:"0",voteProposalBurnUcon:"0"}),m=u({voteDetail:["0","0","0","0"],stakeUCON:"0",processCount:"0",totalUnstakeUcon:"0",pendingUnstakeUcon:"0",unstakeStartTime:"0",avaiUnstakeUcon:"0",totalVote:"0",avaiShareUcon:"0",totalShareUcon:"0",totalExecuteFinishReward:"0",blockFlag:"0",blockSubmitDeadline:"0"}),v=u([]),U=l((()=>{const{dayUnstakeRate:a}=f.value;return new t(1e18).div(new t(a)).toString(10)})),h=l((()=>{const{totalVote:a}=f.value,e=m.value.totalVote;return new t(e).div(new t(a)).times(100).decimalPlaces(0).toString(10)})),g=l((()=>{const{stakeUCON:a}=m.value,{uconStakeIncrease:e}=f.value;if(e.length>0){const n=e[0],o=e[1],s=e[2],c=e[3];return new t(a).comparedTo(new t(c.minStake))>=0?4:new t(a).comparedTo(new t(s.minStake))>=0?3:new t(a).comparedTo(new t(o.minStake))>=0?2:new t(a).comparedTo(new t(n.minStake))>=0?1:0}return 0})),x=l((()=>{const{processCount:a,stakeUCON:e}=m.value;return new t(e).comparedTo(new t("100").times(new t("1e18")))>=0})),I=l((()=>{const{processCount:a}=m.value;return"0"===a}));async function B(){let a=await P(p.value);f.value=a;const e=await R(p.value);m.value={...e}}i(p,(async a=>{if(a){C(e.value,!0);const t=await s.call("hasRole",[k,a]);B(),w.value=t}}),{immediate:!0});const b=l((()=>{const a=v.value,e=a.length;return 0===e?"0x0000000000000000000000000000000000000000000000000000000000000000":a[e-1].proposalInfo.id}));async function C(a,t){if(e.value!==a&&(n.value=!0,o.value=!0),a>-1&&(e.value=a),a=e.value,t&&(v.value=[]),1===a){const a=await y(p.value,c.value,b.value),{infos:e}=a;e.length<Number(c.value)&&(o.value=!1);let t=[];for(let n=0;n<e.length;n++){const{proposalInfo:{status:a,flag:o}}=e[n];(w.value||"2"!==a&&"0"===o)&&t.push(e[n])}v.value=v.value.concat(t)}else{const e=[{index:0,status:"255"},{index:2,status:"4"},{index:3,status:"3"},{index:4,status:"0"},{index:5,status:"1"},{index:6,status:"2"}].find((e=>e.index===a))||{index:0,status:"255"};await async function(a){const{hasRemain:e,infos:t,totalItems:n}=await S(a,c.value,b.value);let s=[];o.value=e;for(let o=0;o<t.length;o++){const{proposalInfo:{status:a,flag:e}}=t[o];(w.value||"2"!==a&&"0"===e)&&s.push(t[o])}return v.value=v.value.concat(s),{hasRemain:e,infos:t,totalItems:n}}(e.status)}o.value&&v.value.length<10&&C(a)}return i(p,(async a=>{if(a){C(e.value,!0);const t=await s.call("hasRole",[k,a]);B(),w.value=t}}),{immediate:!0}),{daoSystemInfo:f,accountInfo:m,proposalList:v,availabelShares:h,identity:g,dayUnstake:U,isRedeem:I,isAdmin:r,isDaoAdmin:w,isStake:x,isHasRemain:o,pageNum:c,getSystemInfo:B,getList:C}}));export{h as a,m as b,g as u};
