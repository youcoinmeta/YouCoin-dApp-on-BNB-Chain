import{g as e,s as t,F as a,u as l,p as r,r as n}from"./index.12eb898d.js";import{c as i,m as o,n as s,t as u,u as c,e as d,j as g,I as f,w as p,l as m,f as v,o as b,q as h,d as y,r as x,v as k,x as S}from"./index.915c7422.js";import{L as w,d as C,g as B,z as M,r as V,f as I,D as A,k as z,R as E,l as L,H as P,a as $}from"./index.134f5e61.js";import{e as j,C as q,m as T}from"./index.e595597c.js";const D={to:[String,Object],url:String,replace:Boolean};function W(){const e=w().proxy;return()=>function({to:e,url:t,replace:a,$router:l}){e&&l?l[a?"replace":"push"](e):t&&(a?location.replace(t):location.href=t)}(e)}let F=0;const[H,R]=i("cell"),O={tag:o("div"),icon:String,size:String,title:s,value:s,label:s,center:Boolean,isLink:Boolean,border:u,iconPrefix:String,valueClass:c,labelClass:c,titleClass:c,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}};const N=p(C({name:H,props:d({},O,D),setup(e,{slots:t}){const a=W(),l=()=>{if(t.label||g(e.label))return B("div",{class:[R("label"),e.labelClass]},[t.label?t.label():e.label])},r=()=>{var a;if(t.title||g(e.title)){const r=null==(a=t.title)?void 0:a.call(t);if(Array.isArray(r)&&0===r.length)return;return B("div",{class:[R("title"),e.titleClass],style:e.titleStyle},[r||B("span",null,[e.title]),l()])}},n=()=>{const a=t.value||t.default;if(a||g(e.value))return B("div",{class:[R("value"),e.valueClass]},[a?a():B("span",null,[e.value])])},i=()=>{if(t["right-icon"])return t["right-icon"]();if(e.isLink){const t=e.arrowDirection&&"right"!==e.arrowDirection?`arrow-${e.arrowDirection}`:"arrow";return B(f,{name:t,class:R("right-icon")},null)}};return()=>{var l;const{tag:o,size:s,center:u,border:c,isLink:d,required:g}=e,p=null!=(l=e.clickable)?l:d,m={center:u,required:!!g,clickable:p,borderless:!c};return s&&(m[s]=!!s),B(o,{class:R(m),role:p?"button":void 0,tabindex:p?0:void 0,onClick:a},{default:()=>{var a;return[t.icon?t.icon():e.icon?B(f,{name:e.icon,class:R("left-icon"),classPrefix:e.iconPrefix},null):void 0,r(),n(),i(),null==(a=t.extra)?void 0:a.call(t)]}})}}}));function K(e){return Array.isArray(e)?!e.length:0!==e&&!e}function G(e,t){const{message:a}=t;return b(a)?a(e,t):a||""}function J({target:e}){e.composing=!0}function Q({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function U(e){return[...e].length}function X(e,t){return[...e].slice(0,t).join("")}const[Y,Z]=i("field");const _=p(C({name:Y,props:d({},O,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:s,max:Number,min:Number,formatter:Function,clearIcon:o("clear"),modelValue:h(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:o("focus"),formatTrigger:o("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},{rows:s,type:o("text"),rules:Array,autosize:[Boolean,Object],labelWidth:s,labelClass:c,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(i,{emit:o,slots:s}){const u=function(){const e=w(),{name:t="unknown"}=(null==e?void 0:e.type)||{};return`${t}-${++F}`}(),c=M({status:"unvalidated",focused:!1,validateMessage:""}),d=V(),p=V(),b=V(),{parent:h}=j(a),C=()=>{var e;return String(null!=(e=i.modelValue)?e:"")},D=e=>g(i[e])?i[e]:h&&g(h.props[e])?h.props[e]:void 0,W=I(()=>{const e=D("readonly");if(i.clearable&&!e){const e=""!==C(),t="always"===i.clearTrigger||"focus"===i.clearTrigger&&c.focused;return e&&t}return!1}),H=I(()=>b.value&&s.input?b.value():i.modelValue),R=I(()=>{var e;const t=D("required");return"auto"===t?null==(e=i.rules)?void 0:e.some(e=>e.required):t}),O=e=>e.reduce((e,t)=>e.then(()=>{if("failed"===c.status)return;let{value:e}=H;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(K(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return c.status="failed",void(c.validateMessage=G(e,t));if(t.validator){if(K(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise(a=>{const l=t.validator(e,t);v(l)?l.then(a):a(l)})}(e,t).then(a=>{a&&"string"==typeof a?(c.status="failed",c.validateMessage=a):!1===a&&(c.status="failed",c.validateMessage=G(e,t))})}}),Promise.resolve()),Y=()=>{c.status="unvalidated",c.validateMessage=""},_=()=>o("endValidate",{status:c.status,message:c.validateMessage}),ee=(e=i.rules)=>new Promise(t=>{Y(),e?(o("startValidate"),O(e).then(()=>{"failed"===c.status?(t({name:i.name,message:c.validateMessage}),_()):(c.status="passed",t(),_())})):t()}),te=e=>{if(h&&i.rules){const{validateTrigger:t}=h.props,a=x(t).includes(e),l=i.rules.filter(t=>t.trigger?x(t.trigger).includes(e):a);l.length&&ee(l)}},ae=(e,t="onChange")=>{var a,l;const r=e;e=(e=>{var t;const{maxlength:a}=i;if(g(a)&&U(e)>+a){const l=C();if(l&&U(l)===+a)return l;const r=null==(t=d.value)?void 0:t.selectionEnd;if(c.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return X(e,+a)}return e})(e);const n=U(r)-U(e);if("number"===i.type||"digit"===i.type){const r="number"===i.type;if(e=k(e,r,r),"onBlur"===t&&""!==e&&(void 0!==i.min||void 0!==i.max)){const t=S(+e,null!=(a=i.min)?a:-1/0,null!=(l=i.max)?l:1/0);+e!==t&&(e=t.toString())}}let s=0;if(i.formatter&&t===i.formatTrigger){const{formatter:t,maxlength:a}=i;if(e=t(e),g(a)&&U(e)>+a&&(e=X(e,+a)),d.value&&c.focused){const{selectionEnd:e}=d.value,a=X(r,e);s=U(t(a))-U(a)}}if(d.value&&d.value.value!==e)if(c.focused){let{selectionStart:t,selectionEnd:a}=d.value;if(d.value.value=e,g(t)&&g(a)){const l=U(e);n?(t-=n,a-=n):s&&(t+=s,a+=s),d.value.setSelectionRange(Math.min(t,l),Math.min(a,l))}}else d.value.value=e;e!==i.modelValue&&o("update:modelValue",e)},le=e=>{e.target.composing||ae(e.target.value)},re=()=>{var e;return null==(e=d.value)?void 0:e.blur()},ne=()=>{var e;return null==(e=d.value)?void 0:e.focus()},ie=()=>{const a=d.value;"textarea"===i.type&&i.autosize&&a&&function(a,l){const r=e();a.style.height="auto";let n=a.scrollHeight;if(m(l)){const{maxHeight:e,minHeight:t}=l;void 0!==e&&(n=Math.min(n,e)),void 0!==t&&(n=Math.max(n,t))}n&&(a.style.height=`${n}px`,t(r))}(a,i.autosize)},oe=e=>{c.focused=!0,o("focus",e),E(ie),D("readonly")&&re()},se=e=>{c.focused=!1,ae(C(),"onBlur"),o("blur",e),D("readonly")||(te("onBlur"),E(ie),n())},ue=e=>o("clickInput",e),ce=e=>o("clickLeftIcon",e),de=e=>o("clickRightIcon",e),ge=I(()=>"boolean"==typeof i.error?i.error:!(!h||!h.props.showError||"failed"!==c.status)||void 0),fe=I(()=>{const e=D("labelWidth"),t=D("labelAlign");if(e&&"top"!==t)return{width:y(e)}}),pe=e=>{if(13===e.keyCode){h&&h.props.submitOnEnter||"textarea"===i.type||r(e),"search"===i.type&&re()}o("keypress",e)},me=()=>i.id||`${u}-input`,ve=()=>{const e=Z("control",[D("inputAlign"),{error:ge.value,custom:!!s.input,"min-height":"textarea"===i.type&&!i.autosize}]);if(s.input)return B("div",{class:e,onClick:ue},[s.input()]);const t={id:me(),ref:d,name:i.name,rows:void 0!==i.rows?+i.rows:void 0,class:e,disabled:D("disabled"),readonly:D("readonly"),autofocus:i.autofocus,placeholder:i.placeholder,autocomplete:i.autocomplete,autocapitalize:i.autocapitalize,autocorrect:i.autocorrect,enterkeyhint:i.enterkeyhint,spellcheck:i.spellcheck,"aria-labelledby":i.label?`${u}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:se,onFocus:oe,onInput:le,onClick:ue,onChange:Q,onKeypress:pe,onCompositionend:Q,onCompositionstart:J};return"textarea"===i.type?B("textarea",P(t,{inputmode:i.inputmode}),null):B("input",P((a=i.type,l=i.inputmode,"number"===a&&(a="text",null!=l||(l="decimal")),"digit"===a&&(a="tel",null!=l||(l="numeric")),{type:a,inputmode:l}),t),null);var a,l},be=()=>{const e=s["right-icon"];if(i.rightIcon||e)return B("div",{class:Z("right-icon"),onClick:de},[e?e():B(f,{name:i.rightIcon,classPrefix:i.iconPrefix},null)])},he=()=>{if(i.showWordLimit&&i.maxlength){const e=U(C());return B("div",{class:Z("word-limit")},[B("span",{class:Z("word-num")},[e]),$("/"),i.maxlength])}},ye=()=>{if(h&&!1===h.props.showErrorMessage)return;const e=i.errorMessage||c.validateMessage;if(e){const t=s["error-message"],a=D("errorMessageAlign");return B("div",{class:Z("error-message",a)},[t?t({message:e}):e])}},xe=()=>[B("div",{class:Z("body")},[ve(),W.value&&B(f,{ref:p,name:i.clearIcon,class:Z("clear")},null),be(),s.button&&B("div",{class:Z("button")},[s.button()])]),he(),ye()];return l({blur:re,focus:ne,validate:ee,formValue:H,resetValidation:Y,getValidationStatus:()=>c.status}),A(q,{customValue:b,resetValidation:Y,validateWithTrigger:te}),z(()=>i.modelValue,()=>{ae(C()),Y(),te("onChange"),E(ie)}),L(()=>{ae(C(),i.formatTrigger),E(ie)}),T("touchstart",e=>{r(e),o("update:modelValue",""),o("clear",e)},{target:I(()=>{var e;return null==(e=p.value)?void 0:e.$el})}),()=>{const e=D("disabled"),t=D("labelAlign"),a=(()=>{const e=s["left-icon"];if(i.leftIcon||e)return B("div",{class:Z("left-icon"),onClick:ce},[e?e():B(f,{name:i.leftIcon,classPrefix:i.iconPrefix},null)])})();return B(N,{size:i.size,class:Z({error:ge.value,disabled:e,[`label-${t}`]:t}),center:i.center,border:i.border,isLink:i.isLink,clickable:i.clickable,titleStyle:fe.value,valueClass:Z("value"),titleClass:[Z("label",[t,{required:R.value}]),i.labelClass],arrowDirection:i.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=D("labelWidth"),t=D("labelAlign"),a=D("colon")?":":"";return s.label?[s.label(),a]:i.label?B("label",{id:`${u}-label`,for:s.input?void 0:me(),"data-allow-mismatch":"attribute",onClick:e=>{r(e),ne()},style:"top"===t&&e?{width:y(e)}:void 0},[i.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:xe,extra:s.extra})}}}));export{N as C,_ as F,O as c};
