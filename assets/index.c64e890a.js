import{g as e,s as t,u as a,F as l,a as r,b as n,p as i,C as o,r as s}from"./index.0ca3c831.js";import{c as u,m as c,b as d,t as g,u as f,e as p,d as v,I as m,w as b,h,a as y,j as k,k as x,l as w,o as S,p as C}from"./index.e6d47851.js";import{L as I,d as V,b as B,A as M,r as A,c as L,E as P,i as $,M as E,j,I as z,k as T}from"./index.014ac6d4.js";const q={to:[String,Object],url:String,replace:Boolean};function D(){const e=I().proxy;return()=>function({to:e,url:t,replace:a,$router:l}){e&&l?l[a?"replace":"push"](e):t&&(a?location.replace(t):location.href=t)}(e)}let W=0;const[F,H]=u("cell"),O={tag:c("div"),icon:String,size:String,title:d,value:d,label:d,center:Boolean,isLink:Boolean,border:g,required:Boolean,iconPrefix:String,valueClass:f,labelClass:f,titleClass:f,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}};const R=b(V({name:F,props:p({},O,q),setup(e,{slots:t}){const a=D(),l=()=>{if(t.label||v(e.label))return B("div",{class:[H("label"),e.labelClass]},[t.label?t.label():e.label])},r=()=>{if(t.title||v(e.title))return B("div",{class:[H("title"),e.titleClass],style:e.titleStyle},[t.title?t.title():B("span",null,[e.title]),l()])},n=()=>{const a=t.value||t.default;if(a||v(e.value))return B("div",{class:[H("value"),e.valueClass]},[a?a():B("span",null,[e.value])])},i=()=>{if(t["right-icon"])return t["right-icon"]();if(e.isLink){const t=e.arrowDirection&&"right"!==e.arrowDirection?`arrow-${e.arrowDirection}`:"arrow";return B(m,{name:t,class:H("right-icon")},null)}};return()=>{var l;const{tag:o,size:s,center:u,border:c,isLink:d,required:g}=e,f=null!=(l=e.clickable)?l:d,p={center:u,required:g,clickable:f,borderless:!c};return s&&(p[s]=!!s),B(o,{class:H(p),role:f?"button":void 0,tabindex:f?0:void 0,onClick:a},{default:()=>{var a;return[t.icon?t.icon():e.icon?B(m,{name:e.icon,class:H("left-icon"),classPrefix:e.iconPrefix},null):void 0,r(),n(),i(),null==(a=t.extra)?void 0:a.call(t)]}})}}}));function K(e){return Array.isArray(e)?!e.length:0!==e&&!e}function G(e,t){const{message:a}=t;return k(a)?a(e,t):a||""}function J({target:e}){e.composing=!0}function N({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function Q(e){return[...e].length}const[U,X]=u("field");const Y=b(V({name:U,props:p({},O,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:d,formatter:Function,clearIcon:c("clear"),modelValue:x(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:c("focus"),formatTrigger:c("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:d,type:c("text"),rules:Array,autosize:[Boolean,Object],labelWidth:d,labelClass:f,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(u,{emit:c,slots:d}){const g=function(){const e=I(),{name:t="unknown"}=(null==e?void 0:e.type)||{};return`${t}-${++W}`}(),f=M({status:"unvalidated",focused:!1,validateMessage:""}),p=A(),b=A(),k=A(),{parent:x}=a(l),V=()=>{var e;return String(null!=(e=u.modelValue)?e:"")},q=e=>v(u[e])?u[e]:x&&v(x.props[e])?x.props[e]:void 0,D=L((()=>{const e=q("readonly");if(u.clearable&&!e){const e=""!==V(),t="always"===u.clearTrigger||"focus"===u.clearTrigger&&f.focused;return e&&t}return!1})),F=L((()=>k.value&&d.input?k.value():u.modelValue)),H=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===f.status)return;let{value:e}=F;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(K(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return f.status="failed",void(f.validateMessage=G(e,t));if(t.validator){if(K(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise((a=>{const l=t.validator(e,t);y(l)?l.then(a):a(l)}))}(e,t).then((a=>{a&&"string"==typeof a?(f.status="failed",f.validateMessage=a):!1===a&&(f.status="failed",f.validateMessage=G(e,t))}))}}))),Promise.resolve()),O=()=>{f.status="unvalidated",f.validateMessage=""},U=()=>c("endValidate",{status:f.status,message:f.validateMessage}),Y=(e=u.rules)=>new Promise((t=>{O(),e?(c("startValidate"),H(e).then((()=>{"failed"===f.status?(t({name:u.name,message:f.validateMessage}),U()):(f.status="passed",t(),U())}))):t()})),Z=e=>{if(x&&u.rules){const{validateTrigger:t}=x.props,a=S(t).includes(e),l=u.rules.filter((t=>t.trigger?S(t.trigger).includes(e):a));l.length&&Y(l)}},_=(e,t="onChange")=>{const a=e,l=(e=(e=>{const{maxlength:t}=u;if(v(t)&&Q(e)>t){const a=V();return a&&Q(a)===+t?a:function(e,t){return[...e].slice(0,t).join("")}(e,+t)}return e})(e))!==a;if("number"===u.type||"digit"===u.type){const t="number"===u.type;e=C(e,t,t)}if(u.formatter&&t===u.formatTrigger&&(e=u.formatter(e)),p.value&&p.value.value!==e)if(f.focused&&l){const{selectionStart:t,selectionEnd:a}=p.value;p.value.value=e,p.value.setSelectionRange(t-1,a-1)}else p.value.value=e;e!==u.modelValue&&c("update:modelValue",e)},ee=e=>{e.target.composing||_(e.target.value)},te=()=>{var e;return null==(e=p.value)?void 0:e.blur()},ae=()=>{const a=p.value;"textarea"===u.type&&u.autosize&&a&&function(a,l){const r=e();a.style.height="auto";let n=a.scrollHeight;if(h(l)){const{maxHeight:e,minHeight:t}=l;void 0!==e&&(n=Math.min(n,e)),void 0!==t&&(n=Math.max(n,t))}n&&(a.style.height=`${n}px`,t(r))}(a,u.autosize)},le=e=>{f.focused=!0,c("focus",e),E(ae),q("readonly")&&te()},re=e=>{q("readonly")||(f.focused=!1,_(V(),"onBlur"),c("blur",e),Z("onBlur"),E(ae),s())},ne=e=>c("clickInput",e),ie=e=>c("clickLeftIcon",e),oe=e=>c("clickRightIcon",e),se=L((()=>"boolean"==typeof u.error?u.error:!(!x||!x.props.showError||"failed"!==f.status)||void 0)),ue=L((()=>{const e=q("labelWidth");if(e)return{width:w(e)}})),ce=e=>{if(13===e.keyCode){x&&x.props.submitOnEnter||"textarea"===u.type||i(e),"search"===u.type&&te()}c("keypress",e)},de=()=>u.id||`${g}-input`,ge=()=>{const e=X("control",[q("inputAlign"),{error:se.value,custom:!!d.input,"min-height":"textarea"===u.type&&!u.autosize}]);if(d.input)return B("div",{class:e,onClick:ne},[d.input()]);const t={id:de(),ref:p,name:u.name,rows:void 0!==u.rows?+u.rows:void 0,class:e,disabled:q("disabled"),readonly:q("readonly"),autofocus:u.autofocus,placeholder:u.placeholder,autocomplete:u.autocomplete,enterkeyhint:u.enterkeyhint,"aria-labelledby":u.label?`${g}-label`:void 0,onBlur:re,onFocus:le,onInput:ee,onClick:ne,onChange:N,onKeypress:ce,onCompositionend:N,onCompositionstart:J};return"textarea"===u.type?B("textarea",t,null):B("input",z("number"===(a=u.type)?{type:"text",inputmode:"decimal"}:"digit"===a?{type:"tel",inputmode:"numeric"}:{type:a},t),null);var a},fe=()=>{const e=d["right-icon"];if(u.rightIcon||e)return B("div",{class:X("right-icon"),onClick:oe},[e?e():B(m,{name:u.rightIcon,classPrefix:u.iconPrefix},null)])},pe=()=>{if(u.showWordLimit&&u.maxlength){const e=Q(V());return B("div",{class:X("word-limit")},[B("span",{class:X("word-num")},[e]),T("/"),u.maxlength])}},ve=()=>{if(x&&!1===x.props.showErrorMessage)return;const e=u.errorMessage||f.validateMessage;if(e){const t=d["error-message"],a=q("errorMessageAlign");return B("div",{class:X("error-message",a)},[t?t({message:e}):e])}},me=()=>[B("div",{class:X("body")},[ge(),D.value&&B(m,{ref:b,name:u.clearIcon,class:X("clear")},null),fe(),d.button&&B("div",{class:X("button")},[d.button()])]),pe(),ve()];return r({blur:te,focus:()=>{var e;return null==(e=p.value)?void 0:e.focus()},validate:Y,formValue:F,resetValidation:O,getValidationStatus:()=>f.status}),P(o,{customValue:k,resetValidation:O,validateWithTrigger:Z}),$((()=>u.modelValue),(()=>{_(V()),O(),Z("onChange"),E(ae)})),j((()=>{_(V(),u.formatTrigger),E(ae)})),n("touchstart",(e=>{i(e),c("update:modelValue",""),c("clear",e)}),{target:L((()=>{var e;return null==(e=b.value)?void 0:e.$el}))}),()=>{const e=q("disabled"),t=q("labelAlign"),a=(()=>{const e=q("colon")?":":"";return d.label?[d.label(),e]:u.label?B("label",{id:`${g}-label`,for:de()},[u.label+e]):void 0})(),l=(()=>{const e=d["left-icon"];if(u.leftIcon||e)return B("div",{class:X("left-icon"),onClick:ie},[e?e():B(m,{name:u.leftIcon,classPrefix:u.iconPrefix},null)])})();return B(R,{size:u.size,class:X({error:se.value,disabled:e,[`label-${t}`]:t}),center:u.center,border:u.border,isLink:u.isLink,clickable:u.clickable,titleStyle:ue.value,valueClass:X("value"),titleClass:[X("label",[t,{required:u.required}]),u.labelClass],arrowDirection:u.arrowDirection},{icon:l&&"top"!==t?()=>l:null,title:a||"top"===t?()=>"top"===t?[l,a]:a:null,value:me,extra:d.extra})}}}));export{R as C,Y as F,O as c};
