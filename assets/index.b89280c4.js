import{h as e,t as a,g as t,z as i,a5 as l,w as s}from"./index.c5a6da3b.js";import{c as o,d as n,a as u,w as r,e as v,f as c,o as h,b as p,i as f,h as d,p as g,u as w}from"./index.e8603419.js";import{d as m,r as b,A as x,c as y,h as C,i as z,B as M,C as $,D as S,b as T,M as D}from"./index.f3e191e6.js";const[I,O]=e("swipe"),X={loop:a,width:t,height:t,vertical:Boolean,autoplay:i(0),duration:i(500),touchable:a,lazyRender:Boolean,initialSwipe:i(0),indicatorColor:String,showIndicators:a,stopPropagation:a},Y=Symbol(I);const j=s(m({name:I,props:X,emits:["change"],setup(e,{emit:a,slots:t}){const i=b(),s=b(),w=x({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),m=o(),{children:I,linkChildren:X}=n(Y),j=y((()=>I.length)),k=y((()=>w[e.vertical?"height":"width"])),B=y((()=>e.vertical?m.deltaY.value:m.deltaX.value)),P=y((()=>{if(w.rect){return(e.vertical?w.rect.height:w.rect.width)-k.value*j.value}return 0})),A=y((()=>k.value?Math.ceil(Math.abs(P.value)/k.value):j.value)),R=y((()=>j.value*k.value)),E=y((()=>(w.active+j.value)%j.value)),H=y((()=>{const a=e.vertical?"vertical":"horizontal";return m.direction.value===a})),W=y((()=>{const a={transitionDuration:`${w.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${w.offset}px)`};if(k.value){const t=e.vertical?"height":"width",i=e.vertical?"width":"height";a[t]=`${R.value}px`,a[i]=e[i]?`${e[i]}px`:""}return a})),q=(a,t=0)=>{let i=a*k.value;e.loop||(i=Math.min(i,-P.value));let s=t-i;return e.loop||(s=l(s,P.value,0)),s},F=({pace:t=0,offset:i=0,emitChange:s})=>{if(j.value<=1)return;const{active:o}=w,n=(a=>{const{active:t}=w;return a?e.loop?l(t+a,-1,j.value):l(t+a,0,A.value):t})(t),u=q(n,i);if(e.loop){if(I[0]&&u!==P.value){const e=u<P.value;I[0].setOffset(e?R.value:0)}if(I[j.value-1]&&0!==u){const e=u>0;I[j.value-1].setOffset(e?-R.value:0)}}w.active=n,w.offset=u,s&&n!==o&&a("change",E.value)},G=()=>{w.swiping=!0,w.active<=-1?F({pace:j.value}):w.active>=j.value&&F({pace:-j.value})},J=()=>{G(),m.reset(),d((()=>{w.swiping=!1,F({pace:1,emitChange:!0})}))};let K;const L=()=>clearTimeout(K),N=()=>{L(),e.autoplay>0&&j.value>1&&(K=setTimeout((()=>{J(),N()}),+e.autoplay))},Q=(a=+e.initialSwipe)=>{if(!i.value)return;const t=()=>{var t,l;if(!f(i)){const a={width:i.value.offsetWidth,height:i.value.offsetHeight};w.rect=a,w.width=+(null!=(t=e.width)?t:a.width),w.height=+(null!=(l=e.height)?l:a.height)}j.value&&(a=Math.min(j.value-1,a)),w.active=a,w.swiping=!0,w.offset=q(a),I.forEach((e=>{e.setOffset(0)})),N()};f(i)?D().then(t):t()},U=()=>Q(w.active);let V;const Z=a=>{e.touchable&&(m.start(a),V=Date.now(),L(),G())},_=()=>{if(!e.touchable||!w.swiping)return;const a=Date.now()-V,t=B.value/a;if((Math.abs(t)>.25||Math.abs(B.value)>k.value/2)&&H.value){const a=e.vertical?m.offsetY.value:m.offsetX.value;let t=0;t=e.loop?a>0?B.value>0?-1:1:0:-Math[B.value>0?"ceil":"floor"](B.value/k.value),F({pace:t,emitChange:!0})}else B.value&&F({pace:0});w.swiping=!1,N()},ee=(a,t)=>{const i=t===E.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return T("i",{style:l,class:O("indicator",{active:i})},null)};return u({prev:()=>{G(),m.reset(),d((()=>{w.swiping=!1,F({pace:-1,emitChange:!0})}))},next:J,state:w,resize:U,swipeTo:(a,t={})=>{G(),m.reset(),d((()=>{let i;i=e.loop&&a===j.value?0===w.active?0:a:a%j.value,t.immediate?d((()=>{w.swiping=!1})):w.swiping=!1,F({pace:i-w.active,emitChange:!0})}))}}),X({size:k,props:e,count:j,activeIndicator:E}),C((()=>e.initialSwipe),(e=>Q(+e))),C(j,(()=>Q(w.active))),C((()=>e.autoplay),N),C([r,v],U),C(c(),(e=>{"visible"===e?N():L()})),z(Q),M((()=>Q(w.active))),h((()=>Q(w.active))),$(L),S(L),p("touchmove",(a=>{if(e.touchable&&w.swiping&&(m.move(a),H.value)){!e.loop&&(0===w.active&&B.value>0||w.active===j.value-1&&B.value<0)||(g(a,e.stopPropagation),F({offset:B.value}))}}),{target:s}),()=>{var a;return T("div",{ref:i,class:O()},[T("div",{ref:s,style:W.value,class:O("track",{vertical:e.vertical}),onTouchstartPassive:Z,onTouchend:_,onTouchcancel:_},[null==(a=t.default)?void 0:a.call(t)]),t.indicator?t.indicator({active:E.value,total:j.value}):e.showIndicators&&j.value>1?T("div",{class:O("indicators",{vertical:e.vertical})},[Array(j.value).fill("").map(ee)]):void 0])}}})),[k,B]=e("swipe-item");const P=s(m({name:k,setup(e,{slots:a}){let t;const i=x({offset:0,inited:!1,mounted:!1}),{parent:l,index:s}=w(Y);if(!l)return;const o=y((()=>{const e={},{vertical:a}=l.props;return l.size.value&&(e[a?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${a?"Y":"X"}(${i.offset}px)`),e})),n=y((()=>{const{loop:e,lazyRender:a}=l.props;if(!a||t)return!0;if(!i.mounted)return!1;const o=l.activeIndicator.value,n=l.count.value-1,u=0===o&&e?n:o-1,r=o===n&&e?0:o+1;return t=s.value===o||s.value===u||s.value===r,t}));return z((()=>{D((()=>{i.mounted=!0}))})),u({setOffset:e=>{i.offset=e}}),()=>{var e;return T("div",{class:B(),style:o.value},[n.value?null==(e=a.default)?void 0:e.call(a):null])}}}));export{P as S,j as a};
