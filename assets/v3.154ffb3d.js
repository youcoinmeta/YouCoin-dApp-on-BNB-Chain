import{c as e,e as a,d as t,m as o,T as n,f as l}from"./contract.874f0703.js";import{B as r,C as c,E as s}from"./contract.792d6314.js";import{N as u,f as i,B as d,r as w,k as m,V as v,S as p,l as f,U as g}from"./index.16dbb63b.js";import{i as S,l as U}from"./index.6d7a3683.js";import{u as k}from"./useUbsV3.e81c6648.js";import{o as R,E as h}from"./orderBy.aaae350c.js";const T=18,A="1000000000000000000000000";class b{startTime;uconPerReleaseAmount;uconLastReleaseTime;uconReleaseInterval;triggerFee;withdrawFee;unlockFee;triggerNum;givingBackDAOUcon;givingBackRewardPoolUcon;givingBackFund;total2Share;total2DAO;total2UconFunder;total2SeroFunder;total2SwapUconFrom;nowAvaiBullUSDT;tokenRewardParam;totalSelfReleaseUcon;totalTreeReleaseUcon;totalBullUSDT;totalBreakUsdt}class B{affLevel;releaseUSD;totalExtraHashRate;directExtraHashRateUSD;id;issueMedalLevel;lastMedalSum;latestMedalLevel;myTarget;pendingUconWithdraw;personHashRateUSD;personHashRateUpdateTime;principalFactor;principalUSD;targetSum;totalAffUconMinnerReward;totalUconMinnerReward;avaiBullReward;totalBreakUsdt;totalBullReward}const{getSysParam:D,getAccount:x}=k(),{getAccountID:P,getUserAccount:y}=e(),F=u("v3",(()=>{const e=a(),u=t(),k=i((()=>e.account)),T=S({time:0,onFinish:()=>{}}),F=d({cur:T.current}),L=w(!1),N=w(new b),M=w(new B),C=w(""),I=w(""),_=w(""),O=w([]),E=w([]),j=w([]),$=i((()=>{const e=E.value.filter((e=>"0"!==e.TotalStake));return R(e,(e=>new r(e.TotalStake).toNumber()),["desc"])})),H=i((()=>E.value.reduce(((e,a)=>e.plus(a.TotalStake)),new r(0)).toString(10))),V=i((()=>E.value.reduce(((e,a)=>{const t=U(a.TotalStakeAmount,a.maxPrice,a.decimal);return e.plus(t)}),new r(0)).toString(10))),z=i((()=>{const e=E.value.filter((e=>"0"!==e.Release)),{totalBullUSDT:a}=N.value;return"0"!==a&&e.push({name:"USDT",decimal:6,Release:U(a,"1000000","18"),price:"1000000"}),R(e,(e=>new r(e.Release).toNumber()),["desc"])})),W=i((()=>{const e=z.value.reduce(((e,a)=>e.plus(a.Release)),new r(0)),{totalBullUSDT:a}=N.value;return e.plus(new r(a).dividedBy(1e12)).toString(10)})),q=i((()=>{const e=z.value.reduce(((e,a)=>{const t=U(a.TotalReleaseAmount,a.maxPrice,a.decimal);return e.plus(t)}),new r(0)),{totalBullUSDT:a}=N.value;return e.plus(a||"0").toString(10)})),G=i((()=>E.value.reduce(((e,a)=>{const{total2UconFunder:t,total2SeroFunder:o}=a,n=new r(t).plus(new r(o)),l=U(n.toString(10),a.price,a.decimal);return e.plus(l)}),new r(0)).toString(10))),J=i((()=>{const e=E.value.filter((e=>"0"!==e.AvaiReward));return R(e,(e=>new r(e.AvaiReward).toNumber()),["desc"])})),K=i((()=>{const e=J.value.reduce(((e,a)=>{const{avaiReward:t,price:o}=a,n=U(t||"0",o,a.decimal);return e.plus(n)}),new r(0)),{avaiBullReward:a}=M.value;return e.plus(new r(a||"0").dividedBy(1e12)).toString(10)})),Q=i((()=>{const e=E.value.filter((e=>!!e.stakeAmountUSD&&"0"!==e.stakeAmountUSD));return R(e,(e=>new r(e.stakeAmountUSD).toNumber()),["desc"])})),X=i((()=>Q.value.reduce(((e,a)=>e.plus(a.stakeAmountUSD||"0")),new r(0)).toString(10))),Y=i((()=>{const e=E.value.filter((e=>"0"!==e.lockAmount));return R(e,(e=>new r(e.lockAmount).toNumber()),["desc"])})),Z=i((()=>{const{principalFactor:e}=M.value;return e&&"0"!==e?new r(1).dividedBy(new r(e).dividedBy(new r(1e18))).decimalPlaces(2).toString(10):"0"})),ee=i((()=>{if(N.value.tokenRewardParam){const e=N.value.tokenRewardParam.allowThreshold,a=new r(e).comparedTo(new r(I.value||"0"));return-1===a||0===a||1!==a&&a}return!1})),ae=i((()=>{const e=E.value.find((e=>"UCON"===e.name));return e?e.price:"0"})),te=i((()=>{const e=E.value.find((e=>"UCON"===e.name));return e?e.maxPrice:"0"})),oe=i((()=>E.value.reduce(((e,a)=>{const{total2UconFunder:t,total2SeroFunder:o}=a,n=U(t,a.maxPrice,a.decimal),l=U(o,a.maxPrice,a.decimal);return e.plus(n).plus(l)}),new r(0)).toString(10))),ne=i((()=>E.value.reduce(((e,a)=>{const t=U(a.bullPool,a.price,a.decimal);return e.plus(t)}),new r(0)).toString(10))),le=i((()=>E.value.reduce(((e,a)=>{const t=U(a.bullPool,a.maxPrice,a.decimal);return e.plus(t)}),new r(0)).toString(10))),re=i((()=>E.value.reduce(((e,a)=>{const t=U(a.bullPool,a.maxPrice,a.decimal),o=U(a.bullReleased,a.maxPrice,a.decimal);return e.plus(t).plus(o)}),new r(0)).toString(10))),ce=i((()=>{const{releaseUSD:e,principalUSD:a}=M.value;return 1===new r(e).comparedTo(new r(a))})),se=i((()=>{const e=E.value;return R(e,(e=>{const a=new r(U(e.bal||"0",e.price,e.decimal)).toString();return Number(a)}),["desc"])}));function ue(e){const a=n.find((a=>a.addr.toLocaleLowerCase()===e.toLocaleLowerCase()));return a&&a.name}async function ie(){const{param:a,tis:t}=await D(!1),n=(new Date).getTime();N.value={...a};const l=t,i=l.length;E.value=[];let d=await P(k.value);const w="0"!==d.id;let m=null;if(w){const a=await y(d.id);C.value=d.id,O.value=a.accountInfo.withdrawAddrs;try{let a=await de();m=await x(e.account,a,!1)}catch(F){}!async function(){const a="https://resource.githnet.com/api";try{const e=await v.get(`${a}/v3/getPow?id=${C.value}`);0===e.data.code&&(I.value=new r(e.data.result.value).toString(10),_.value=new r(e.data.result.directPow).toString(10))}catch(F){const{href:t,version:o,user_agent:n}=g();p({error_code:500,error_message:"",browser_fingerprint:"550e8400-e29b-41d4-a716-446655440000",user_id:e.account,context:{name:"getPow",address:e.account,version:o},user_agent:n,page_url:encodeURIComponent(t)})}}();const{atis:t,aci:o,ai:n}=m,{issueMedalLevel:l,latestMedalLevel:c}=n;u.changeV3(l,c);const{avaiBullReward:s}=n,i=localStorage.getItem("nowAvaiBullUSDT")||"";"0"!==s&&i!=s&&(L.value=!0),M.value={...o,...n}}else M.value=new B;const f=[];for(let e=0;e<i;e++){const{addr:a,expansionFactor:t,decimal:o,price:n,totalStake:c,flag:s,totalAffRelease:u,totalUnlock:i}=l[e];let d=Math.log10(Number(o)).toString(10);const v=U(c,n,d),p=c,g=ue(a),{totalSelfReleaseUcon:S,totalTreeReleaseUcon:k}=N.value,R="UCON"===g?new r(u).plus(i).plus(S).plus(k).toString(10):new r(u).plus(i).toString(10),h=U(R,n,d),T=R,A=1===new r(t).comparedTo(new r(10).exponentiatedBy(18)),b="1"===s;if(w){const{atis:a}=m,{avaiReward:t,totalStake:o,totalStakeUSD:r,lockAmount:c}=a[e],s=U(t,n,d);f.push({...l[e],name:g,isArrow:A,TotalStakeAmount:p,TotalStake:v,...a[e],TotalReleaseAmount:T,Release:h,AvaiReward:s,decimal:d,isPos:b,userTotalStake:o,userTotalStakeUSD:r,lockAmount:c})}else f.push({...l[e],name:g,isArrow:A,TotalStakeAmount:p,TotalStake:v,TotalReleaseAmount:T,Release:h,AvaiReward:"0",decimal:d,isPos:b,userTotalStake:"0",userTotalStakeUSD:"0",lockAmount:"0"})}E.value=f;const{uconLastReleaseTime:S,uconReleaseInterval:R}=N.value;new r(S).plus(new r(R)).toString(10);const h=Math.ceil((new Date).getTime()/1e3);let A=Math.floor(h/Number(R))*Number(R)+Number(R);A-Number(S)<Number(R)&&(A+=Number(R));const b=1e3*A-n;T.reset(Number(b)),T.start(),async function(){const e=E.value,a=e.length,t="0xF882368B672290f174D57C1c0A1ac4Fc21525C87",n=[],l=[];for(let o=0;o<a;o++){const{addr:a}=e[o],r=new c(s,a,"v3 getTokenBal"),u=await r.callData("balanceOf",[k.value]),i=await r.callData("allowance",[k.value,t]);n.push(u),l.push(i)}const r=await o.multicall(n),u=await o.multicall(l);for(let o=0;o<a;o++)e[o].bal=r[o][0],e[o].approve=u[o][0]}()}async function de(a){try{const e="https://resource.githnet.com/api",t=a?`?id=${C.value}&type=1`:`?id=${C.value}`,o=await v.get(`${e}/v3/getSignData${t}`);if(0===o.data.code)return o.data.result;if(!a){const e=(new Date).getTime(),a=Math.floor(e/1e3),t=new Array(20).fill("0");return[[a.toString(),t],"0x28694e88ad553b0d79adaf40dce5f6bcf3a12ae105a938386021dff729d8dc8c0e6dcae1b8d9a09ff3709f77d1744381ac3927cd4ea201279518a863f42fa6ec1b"]}throw new Error("error code: 4001")}catch(t){if(!a){const a=(new Date).getTime(),o=Math.floor(a/1e3),n=new Array(20).fill("0");let l=[[o.toString(),n],"0x28694e88ad553b0d79adaf40dce5f6bcf3a12ae105a938386021dff729d8dc8c0e6dcae1b8d9a09ff3709f77d1744381ac3927cd4ea201279518a863f42fa6ec1b"];const{href:r,version:c,user_agent:s}=g();return t.stack,p({error_code:500,error_message:"",browser_fingerprint:"550e8400-e29b-41d4-a716-446655440000",user_id:e.account,context:{name:"getInputData",address:e.account,version:c},user_agent:s,page_url:encodeURIComponent(r)}),l}throw new Error("error code: 5001")}}m(k,(async e=>{e&&ie()}));const we=w({pageSize:20,pageNum:1}),me=w(!1);return f((async()=>{k.value&&ie()})),{showBull:L,totalStakeUsdt:H,totalStakeUsdtMax:V,totalReleaseUsdt:W,totalReleaseUsdtMax:q,givingBackFund:G,givingBackFundMax:oe,posList:j,current:F,tokenList:E,avaiRewardList:J,totalAvaiReward:K,systemInfo:N,userTotalStake:X,uconPrice:ae,uconPriceMax:te,account:k,accountInfo:M,principalFactor:Z,stakeList:$,stakeUserList:Q,unlockUserList:Y,releaseList:z,selectTokenList:se,withdrawAddrs:O,accountPow:I,directPow:_,isShowPos:ee,isUnlockType:ce,totalBull:ne,totalBullMax:le,totalBullMax1:re,accountID:C,getSystemInfo:ie,closeBull:function(e){e&&localStorage.setItem("nowAvaiBullUSDT",M.value.avaiBullReward),L.value=!1},getInputDate:de,getBalApprove:async function(e){const a=new h(e),t=k.value;return{bal:await a.call("balanceOf",[k.value]),approve:await a.call("allowance",[t,"0xF882368B672290f174D57C1c0A1ac4Fc21525C87"])}},setApprove:async function(e){const a=new h(e),t="SERO"===ue(e)?"10000000000000000000000000":A;try{const o=E.value.findIndex((a=>a.addr===e));if(o>-1){await a.execute("approve",["0xF882368B672290f174D57C1c0A1ac4Fc21525C87",t]);const e=k.value,n="0xF882368B672290f174D57C1c0A1ac4Fc21525C87",l=await a.call("allowance",[e,n]);E.value[o].approve=l;return await a.call("allowance",[e,n])}}catch(o){}},updateTokenBal:async function(e,a){const t=E.value.findIndex((a=>a.addr.toLocaleLowerCase()===e.toLocaleLowerCase()));if(t>-1){const a=new h(e),o=await a.call("balanceOf",[k.value]);E.value[t].bal=o}},getPosList:async function(){const e=(await v.post("https://resource.githnet.com/api/v3/getPosList",we.value)).data.result;we.value.pageNum++;for(let t=0;t<e.length;t++)try{const a=l(e[t].txHash);j.value.push({...a,timestamp:e[t].createTime})}catch(a){throw new Error(a)}e.length>=we.value.pageSize?me.value=!0:me.value=!1},resetPos:function(){j.value=[],we.value.pageNum=1},isMore:me}}));export{A as T,T as U,F as u};
