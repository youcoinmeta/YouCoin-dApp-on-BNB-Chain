import{c as e,e as a,d as t,m as l,f as o,T as n,g as r}from"./contract.d1440be0.js";import{B as c,C as s,E as u}from"./contract.975143a6.js";import{i,l as d}from"./index.565d77dd.js";import{N as w,f as m,B as v,r as p,k as f,l as S}from"./index.5a641305.js";import{u as g}from"./useUbsV3.372d7fc2.js";import{o as U,E as k}from"./orderBy.11a9d157.js";const R=18,T="1000000000000000000000000";class h{startTime;uconPerReleaseAmount;uconLastReleaseTime;uconReleaseInterval;triggerFee;withdrawFee;unlockFee;triggerNum;givingBackDAOUcon;givingBackRewardPoolUcon;givingBackFund;total2Share;total2DAO;total2UconFunder;total2SeroFunder;total2SwapUconFrom;nowAvaiBullUSDT;tokenRewardParam;totalSelfReleaseUcon;totalTreeReleaseUcon;totalBullUSDT;totalBreakUsdt}class A{affLevel;releaseUSD;totalExtraHashRate;directExtraHashRateUSD;id;issueMedalLevel;lastMedalSum;latestMedalLevel;myTarget;pendingUconWithdraw;personHashRateUSD;personHashRateUpdateTime;principalFactor;principalUSD;targetSum;totalAffUconMinnerReward;totalUconMinnerReward;avaiBullReward;totalBreakUsdt;totalBullReward}const{getSysParam:B,getAccount:D}=g(),{getAccountID:b,getUserAccount:x}=e(),P=w("v3",(()=>{const e=a(),w=t(),g=m((()=>e.account)),R=i({time:0,onFinish:()=>{}}),P=v({cur:R.current}),y=p(!1),F=p(new h),L=p(new A),N=p(""),M=p(""),C=p(""),I=p([]),O=p([]),E=p([]),j=m((()=>{const e=O.value.filter((e=>"0"!==e.TotalStake));return U(e,(e=>new c(e.TotalStake).toNumber()),["desc"])})),$=m((()=>O.value.reduce(((e,a)=>e.plus(a.TotalStake)),new c(0)).toString(10))),H=m((()=>O.value.reduce(((e,a)=>{const t=d(a.TotalStakeAmount,a.maxPrice,a.decimal);return e.plus(t)}),new c(0)).toString(10))),z=m((()=>{const e=O.value.filter((e=>"0"!==e.Release)),{totalBullUSDT:a}=F.value;return"0"!==a&&e.push({name:"USDT",decimal:6,Release:d(a,"1000000","18"),price:"1000000"}),U(e,(e=>new c(e.Release).toNumber()),["desc"])})),V=m((()=>{const e=z.value.reduce(((e,a)=>e.plus(a.Release)),new c(0)),{totalBullUSDT:a}=F.value;return e.plus(new c(a).dividedBy(1e12)).toString(10)})),W=m((()=>{const e=z.value.reduce(((e,a)=>{const t=d(a.TotalReleaseAmount,a.maxPrice,a.decimal);return e.plus(t)}),new c(0)),{totalBullUSDT:a}=F.value;return e.plus(a||"0").toString(10)})),q=m((()=>O.value.reduce(((e,a)=>{const{total2UconFunder:t,total2SeroFunder:l}=a,o=new c(t).plus(new c(l)),n=d(o.toString(10),a.price,a.decimal);return e.plus(n)}),new c(0)).toString(10))),G=m((()=>{const e=O.value.filter((e=>"0"!==e.AvaiReward));return U(e,(e=>new c(e.AvaiReward).toNumber()),["desc"])})),J=m((()=>{const e=G.value.reduce(((e,a)=>{const{avaiReward:t,price:l}=a,o=d(t||"0",l,a.decimal);return e.plus(o)}),new c(0)),{avaiBullReward:a}=L.value;return e.plus(new c(a||"0").dividedBy(1e12)).toString(10)})),K=m((()=>{const e=O.value.filter((e=>!!e.stakeAmountUSD&&"0"!==e.stakeAmountUSD));return U(e,(e=>new c(e.stakeAmountUSD).toNumber()),["desc"])})),Q=m((()=>K.value.reduce(((e,a)=>e.plus(a.stakeAmountUSD||"0")),new c(0)).toString(10))),X=m((()=>{const e=O.value.filter((e=>"0"!==e.lockAmount));return U(e,(e=>new c(e.lockAmount).toNumber()),["desc"])})),Y=m((()=>{const{principalFactor:e}=L.value;return e&&"0"!==e?new c(1).dividedBy(new c(e).dividedBy(new c(1e18))).decimalPlaces(2).toString(10):"0"})),Z=m((()=>{if(F.value.tokenRewardParam){const e=F.value.tokenRewardParam.allowThreshold,a=new c(e).comparedTo(new c(M.value||"0"));return-1===a||0===a||1!==a&&a}return!1})),_=m((()=>{const e=O.value.find((e=>"UCON"===e.name));return e?e.price:"0"})),ee=m((()=>{const e=O.value.find((e=>"UCON"===e.name));return e?e.maxPrice:"0"})),ae=m((()=>O.value.reduce(((e,a)=>{const{total2UconFunder:t,total2SeroFunder:l}=a,o=d(t,a.maxPrice,a.decimal),n=d(l,a.maxPrice,a.decimal);return e.plus(o).plus(n)}),new c(0)).toString(10))),te=m((()=>O.value.reduce(((e,a)=>{const t=d(a.bullPool,a.price,a.decimal);return e.plus(t)}),new c(0)).toString(10))),le=m((()=>O.value.reduce(((e,a)=>{const t=d(a.bullPool,a.maxPrice,a.decimal);return e.plus(t)}),new c(0)).toString(10))),oe=m((()=>O.value.reduce(((e,a)=>{const t=d(a.bullPool,a.maxPrice,a.decimal),l=d(a.bullReleased,a.maxPrice,a.decimal);return e.plus(t).plus(l)}),new c(0)).toString(10))),ne=m((()=>{const{releaseUSD:e,principalUSD:a}=L.value;return 1===new c(e).comparedTo(new c(a))})),re=m((()=>{const e=O.value;return U(e,(e=>{const a=new c(d(e.bal||"0",e.price,e.decimal)).toString();return Number(a)}),["desc"])}));function ce(e){const a=n.find((a=>a.addr.toLocaleLowerCase()===e.toLocaleLowerCase()));return a&&a.name}async function se(){const{param:a,tis:t}=await B(!1),n=(new Date).getTime();F.value={...a};const r=t,i=r.length;O.value=[];let m=await b(g.value);const v="0"!==m.id;let p=null;if(v){const a=await x(m.id);N.value=m.id,I.value=a.accountInfo.withdrawAddrs;try{let a=await ue();p=await D(e.account,a,!1)}catch(P){}!async function(){const e="https://resource.githnet.com/api";try{const a=await o.get(`${e}/v3/getPow?id=${N.value}`);0===a.data.code&&(M.value=new c(a.data.result.value).toString(10),C.value=new c(a.data.result.directPow).toString(10))}catch(P){}}();const{atis:t,aci:l,ai:n}=p,{issueMedalLevel:r,latestMedalLevel:s}=n;w.changeV3(r,s);const{avaiBullReward:u}=n,i=localStorage.getItem("nowAvaiBullUSDT")||"";"0"!==u&&i!=u&&(y.value=!0),L.value={...l,...n}}else L.value=new A;const f=[];for(let e=0;e<i;e++){const{addr:a,expansionFactor:t,decimal:l,price:o,totalStake:n,flag:s,totalAffRelease:u,totalUnlock:i}=r[e];let w=Math.log10(Number(l)).toString(10);const m=d(n,o,w),S=n,g=ce(a),{totalSelfReleaseUcon:U,totalTreeReleaseUcon:k}=F.value,R="UCON"===g?new c(u).plus(i).plus(U).plus(k).toString(10):new c(u).plus(i).toString(10),T=d(R,o,w),h=R,A=1===new c(t).comparedTo(new c(10).exponentiatedBy(18)),B="1"===s;if(v){const{atis:a}=p,{avaiReward:t,totalStake:l,totalStakeUSD:n,lockAmount:c}=a[e],s=d(t,o,w);f.push({...r[e],name:g,isArrow:A,TotalStakeAmount:S,TotalStake:m,...a[e],TotalReleaseAmount:h,Release:T,AvaiReward:s,decimal:w,isPos:B,userTotalStake:l,userTotalStakeUSD:n,lockAmount:c})}else f.push({...r[e],name:g,isArrow:A,TotalStakeAmount:S,TotalStake:m,TotalReleaseAmount:h,Release:T,AvaiReward:"0",decimal:w,isPos:B,userTotalStake:"0",userTotalStakeUSD:"0",lockAmount:"0"})}O.value=f;const{uconLastReleaseTime:S,uconReleaseInterval:U}=F.value;new c(S).plus(new c(U)).toString(10);const k=Math.ceil((new Date).getTime()/1e3);let T=Math.floor(k/Number(U))*Number(U)+Number(U);T-Number(S)<Number(U)&&(T+=Number(U));const h=1e3*T-n;R.reset(Number(h)),R.start(),async function(){const e=O.value,a=e.length,t="0xF882368B672290f174D57C1c0A1ac4Fc21525C87",o=[],n=[];for(let l=0;l<a;l++){const{addr:a}=e[l],r=new s(u,a,"v3 getTokenBal"),c=await r.callData("balanceOf",[g.value]),i=await r.callData("allowance",[g.value,t]);o.push(c),n.push(i)}const r=await l.multicall(o),c=await l.multicall(n);for(let l=0;l<a;l++)e[l].bal=r[l][0],e[l].approve=c[l][0]}()}async function ue(e){try{const a="https://resource.githnet.com/api",t=e?`?id=${N.value}&type=1`:`?id=${N.value}`,l=await o.get(`${a}/v3/getSignData${t}`);if(0===l.data.code)return l.data.result;if(!e){const e=(new Date).getTime(),a=Math.floor(e/1e3),t=new Array(20).fill("0");return[[a.toString(),t],"0x28694e88ad553b0d79adaf40dce5f6bcf3a12ae105a938386021dff729d8dc8c0e6dcae1b8d9a09ff3709f77d1744381ac3927cd4ea201279518a863f42fa6ec1b"]}throw new Error("error code: 4001")}catch(a){if(!e){const e=(new Date).getTime(),a=Math.floor(e/1e3),t=new Array(20).fill("0");return[[a.toString(),t],"0x28694e88ad553b0d79adaf40dce5f6bcf3a12ae105a938386021dff729d8dc8c0e6dcae1b8d9a09ff3709f77d1744381ac3927cd4ea201279518a863f42fa6ec1b"]}throw new Error("error code: 5001")}}f(g,(async e=>{e&&se()}));const ie=p({pageSize:20,pageNum:1}),de=p(!1);return S((async()=>{g.value&&se()})),{showBull:y,totalStakeUsdt:$,totalStakeUsdtMax:H,totalReleaseUsdt:V,totalReleaseUsdtMax:W,givingBackFund:q,givingBackFundMax:ae,posList:E,current:P,tokenList:O,avaiRewardList:G,totalAvaiReward:J,systemInfo:F,userTotalStake:Q,uconPrice:_,uconPriceMax:ee,account:g,accountInfo:L,principalFactor:Y,stakeList:j,stakeUserList:K,unlockUserList:X,releaseList:z,selectTokenList:re,withdrawAddrs:I,accountPow:M,directPow:C,isShowPos:Z,isUnlockType:ne,totalBull:te,totalBullMax:le,totalBullMax1:oe,accountID:N,getSystemInfo:se,closeBull:function(e){e&&localStorage.setItem("nowAvaiBullUSDT",L.value.avaiBullReward),y.value=!1},getInputDate:ue,getBalApprove:async function(e){const a=new k(e),t=g.value;return{bal:await a.call("balanceOf",[g.value]),approve:await a.call("allowance",[t,"0xF882368B672290f174D57C1c0A1ac4Fc21525C87"])}},setApprove:async function(e){const a=new k(e),t="SERO"===ce(e)?"10000000000000000000000000":T;try{const l=O.value.findIndex((a=>a.addr===e));if(l>-1){await a.execute("approve",["0xF882368B672290f174D57C1c0A1ac4Fc21525C87",t]);const e=g.value,o="0xF882368B672290f174D57C1c0A1ac4Fc21525C87",n=await a.call("allowance",[e,o]);O.value[l].approve=n;return await a.call("allowance",[e,o])}}catch(l){}},updateTokenBal:async function(e,a){const t=O.value.findIndex((a=>a.addr.toLocaleLowerCase()===e.toLocaleLowerCase()));if(t>-1){const a=new k(e),l=await a.call("balanceOf",[g.value]);O.value[t].bal=l}},getPosList:async function(){const e=(await o.post("https://resource.githnet.com/api/v3/getPosList",ie.value)).data.result;ie.value.pageNum++;for(let t=0;t<e.length;t++)try{const a=r(e[t].txHash);E.value.push({...a,timestamp:e[t].createTime})}catch(a){throw new Error(a)}e.length>=ie.value.pageSize?de.value=!0:de.value=!1},resetPos:function(){E.value=[],ie.value.pageNum=1},isMore:de}}));export{T,R as U,P as u};
